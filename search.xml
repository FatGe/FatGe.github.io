<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title><![CDATA[React-sortable-hoc ç»“åˆ hook å®žçŽ° Draggin å’Œ Droppin]]></title>
    <url>%2F2019%2F08%2F23%2Freact-sortable-hoc%2F</url>
    <content type="text"><![CDATA[ç¿»è¯‘ï¼šhttps://css-tricks.com/draggin-and-droppin-in-react/ React ç¤¾åŒºæä¾›äº†è®¸å¤šçš„åº“æ¥å®žçŽ°æ‹–æ”¾çš„åŠŸèƒ½ï¼Œä¾‹å¦‚ react-dnd, react-beautiful-dnd, react-drag-n-dropï¼Œç­‰ç­‰ã€‚ä½†æ˜¯å®ƒä»¬æœ‰ä¸€äº›å…±åŒçš„ç¼ºé™·ï¼š ä½¿ç”¨å¤æ‚ï¼Œæœ‰æ—¶å€™éœ€è¦åšå¾ˆå¤šå·¥ä½œæ‰èƒ½æž„å»ºä¸€ä¸ªç®€å•çš„æ‹–æ”¾æ¼”ç¤ºï¼› åŠŸèƒ½æœ‰é™ï¼Œä¾‹å¦‚æ— æ³•å®žçŽ°å¤šä¸ªæ‹–æ”¾å®žä¾‹è¿™æ ·å¤æ‚çš„åŠŸèƒ½ï¼Œå¦‚æžœæœ‰çš„è¯ï¼Œå®ƒä¹Ÿä¼šå˜å¾—éžå¸¸å¤æ‚ã€‚ ä¸ºäº†è§£å†³è¿™äº›é—®é¢˜ï¼Œreact-sortable-hoc åº”è¿è€Œç”Ÿã€‚ è¿™ç¯‡æ•™ç¨‹éœ€è¦ä½ æå‰äº†è§£ä¸€äº› React ç»„ä»¶ä»¥åŠ hooks çš„åŸºç¡€çŸ¥è¯†ã€‚ React å®˜æ–¹æŽ¨èçš„å°è£…é«˜é˜¶ç»„ä»¶çš„æ–¹å¼æ˜¯ HOCï¼Œæˆ‘ä»¬éœ€è¦å€ŸåŠ©å®ƒæ¥å®žçŽ°ä¸€ä¸ªå…·æœ‰æ‹–æ”¾åŠŸèƒ½çš„é«˜é˜¶ç»„ä»¶ã€‚ HOC è‡ªèº«ä¸æ˜¯ React API çš„ä¸€éƒ¨åˆ†ï¼Œå®ƒæ˜¯ä¸€ç§åŸºäºŽ React çš„ç»„åˆç‰¹æ€§è€Œå½¢æˆçš„è®¾è®¡æ¨¡å¼ã€‚ å¯åŠ¨é¡¹ç›®æ•™ç¨‹æœ€ç»ˆçš„ç›®çš„æ˜¯æž„å»ºä¸€ä¸ªå¸¦æœ‰è¶£GIFçš„åº”ç”¨ç¨‹åºï¼ˆæ¥è‡ªChris Gannonï¼ï¼‰ï¼Œå¯ä»¥åœ¨è§†å£å‘¨å›´æ‹–åŠ¨ã€‚å…·ä½“è§ é¦–å…ˆï¼Œæˆ‘ä»¬åˆ©ç”¨ create-react-app æ¥å¯åŠ¨ä¸€ä¸ªæ–°çš„ React é¡¹ç›®ï¼š 1npx create-react-app your-project-name ä¹‹åŽåœ¨é¡¹ç›®ä¸­å®‰è£… react-sorting-hoc ä»¥åŠ array-moveï¼ŒåŽè€…æ˜¯ç”¨æ¥å®žçŽ°æ•°ç»„ç§»åŠ¨ã€‚ 12cd your-project-nameyarn add react-sortable-hoc array-move åˆ›å»º GIF ç»„ä»¶ï¼Œæ·»åŠ æ ·å¼å’Œæ•°æ®ä¸ºç®€å•èµ·è§ï¼Œæˆ‘ä»¬å°†åœ¨ App.css æ–‡ä»¶ä¸­ç¼–å†™æ‰€æœ‰æ ·å¼ã€‚ä½ å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å†…å®¹å¯¹æ—¢æœ‰æ ·å¼è¿›è¡Œè¦†ç›–ï¼š 1234567891011121314151617181920212223.App &#123; background: #1a1919; color: #fff; min-height: 100vh; padding: 25px; text-align: center;&#125;.App h1 &#123; font-size: 52px; margin: 0;&#125;.App h2 &#123; color: #f6c945; text-transform: uppercase;&#125;.App img &#123; cursor: grab; height: 180px; width: 240px;&#125; æŽ¥ä¸‹æ¥ï¼Œè®©æˆ‘ä»¬ä½¿ç”¨ React çš„ useState hook æ¥å®žçŽ° GIF ç»„ä»¶ 1import React, &#123; useState &#125; from 'react'; åœ¨srcç›®å½•ä¸­åˆ›å»ºä¸€ä¸ª Gif.js æ–‡ä»¶å¹¶å†™å…¥ä»¥ä¸‹ä»£ç ï¼š 12345678910import React from 'react';import PropTypes from 'prop-types';const Gif = (&#123; gif &#125;) =&gt; (&lt;img src=&#123;gif&#125; alt="gif" /&gt;)Gif.propTypes = &#123; gif: PropTypes.string.isRequired,&#125;;export default Gif; ç¼–å†™ä»£ç æ—¶å°½åŠ›éµå¾ªæœ€ä½³å®žè·µï¼Œå› æ­¤æˆ‘ä»¬è¿˜å¯¼å…¥ PropTypes è¿›è¡Œç±»åž‹æ£€æŸ¥ã€‚ä¹‹åŽå°†Gif ç»„ä»¶å¹¶å°†å…¶æ·»åŠ åˆ° App ä¸­ 12345678910111213141516171819import React, &#123; useState &#125; from 'react';import './App.css';import Gif from './Gif';const App = () =&gt; &#123; const [gifs, setGifs] = useState(['https://media.giphy.com/media/3ohhwoWSCtJzznXbuo/giphy.gif','https://media.giphy.com/media/l46CbZ7KWEhN1oci4/giphy.gif','https://media.giphy.com/media/3ohzgD1wRxpvpkDCSI/giphy.gif','https://media.giphy.com/media/xT1XGYy9NPhWRPp4pq/giphy.gif',]); return ( &lt;div className="App"&gt; &lt;h1&gt;Drag those GIFs around&lt;/h1&gt; &lt;h2&gt;Set 1&lt;/h2&gt; &#123;gifs.map((gif, i) =&gt; &lt;Gif key=&#123;gif&#125; gif=&#123;gif&#125; /&gt;)&#125; &lt;/div&gt; );&#125;export default App; è¿è¡Œ npm run startï¼Œè®¿é—® http://localhost:3000/ï¼Œå¯ä»¥çœ‹åˆ°å¦‚ä¸‹ç»“æžœ æ·»åŠ æ‹–æ”¾åŠŸèƒ½çŽ°åœ¨è®©æˆ‘ä»¬å¯¹ Gif ç»„ä»¶æ·»åŠ æ‹–æ‹½åŠŸèƒ½ã€‚é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦äº†è§£ react-sortable-hoc çš„ä¸¤ä¸ª HOCï¼Œä»¥åŠ array-move çš„ arrayMove æ–¹æ³•ï¼Œä»¥ä¾¿äºŽåœ¨æ‹–åŠ¨å‘ç”Ÿä¿®æ”¹æ•°ç»„ã€‚é¦–å…ˆå¼•å…¥å¯¹åº”ç»„ä»¶ä»¥åŠæ–¹æ³• 12import &#123; sortableContainer, sortableElement &#125; from 'react-sortable-hoc';import arrayMove from 'array-move'; ä¹‹å‰æåˆ°è¿‡ HOCï¼Œæœ¬è´¨ä¸Šé«˜é˜¶ç»„ä»¶æ˜¯å‚æ•°ä¸ºç»„ä»¶ï¼Œè¿”å›žå€¼ä¸ºæ–°ç»„ä»¶çš„å‡½æ•°ã€‚ 1const EnhancedComponent = higherOrderComponent(WrappedComponent); å¯ä»¥çœ‹å‡ºï¼ŒHOC å°±æ˜¯åœ¨å½“å‰ component çš„å¤–å±‚åŒ…è£¹æˆ‘ä»¬æ‰€éœ€è¦å®žçŽ°çš„åŠŸèƒ½ã€‚æ‰€ä»¥ sortableContainerï¼ŒsortableElement å°±æ˜¯ higherOrderComponentã€‚ sortableContainer æ˜¯æ‰€æœ‰å¯æŽ’åºå…ƒç´ çš„å®¹å™¨ï¼› sortableElement æ˜¯æ¯ä¸ªå¯æ¸²æŸ“å…ƒç´ çš„å®¹å™¨ã€‚ import ä¹‹åŽæˆ‘ä»¬è¦åšçš„æ˜¯ 123const SortableGifsContainer = sortableContainer((&#123; children &#125;) =&gt; &lt;div className="gifs"&gt;&#123;children&#125;&lt;/div&gt;);const SortableGif = sortableElement((&#123; gif &#125;) =&gt; &lt;Gif key=&#123;gif&#125; gif=&#123;gif&#125; /&gt;); SortableGif ä¸ºæ¯ä¸ªå­å…ƒç´ åˆ›å»ºäº†ä¸€ä¸ªå®¹å™¨ï¼Œä¹Ÿå°±æ˜¯ä¸ºå•ä¸ª Gif ç»„ä»¶åˆ›å»ºã€‚å®ƒä»¬å°†ä½¿ç”¨åœ¨ SortableGifsContainer ä¸­ï¼Œä»¥ children å±žæ€§ä¼ é€’è¿›åŽ» æ³¨ï¼šæ‚¨éœ€è¦å°†æ¯ä¸ªå­é¡¹åœ¨ div æˆ–ä»»ä½•å…¶ä»–æœ‰æ•ˆçš„ HTML å…ƒç´ ä¸­ã€‚ ç„¶åŽç”¨æ–°åˆ›å»ºçš„ SortableGif æ›¿æ¢åŽŸæœ‰çš„ Gif ç»„ä»¶ï¼Œå¹¶åœ¨ SortableGifsContainer ä¸­ä½¿ç”¨ã€‚ 12345678910&lt;SortableGifsContainer axis="x" onSortEnd=&#123;onSortEnd&#125;&gt; &#123;gifs.map((gif, i) =&gt; &lt;SortableGif // don't forget to pass index prop with item index index=&#123;i&#125; key=&#123;gif&#125; gif=&#123;gif&#125; /&gt; )&#125;&lt;/SortableGifsContainer&gt; è¯·åŠ¡å¿…æ³¨æ„ï¼Œæ‚¨éœ€è¦å°† index propä¼ é€’ç»™å¯æŽ’åºå…ƒç´ ï¼Œä»¥ä¾¿åº“å¯ä»¥åŒºåˆ†æ¯ä¸€ä¸ªå­é¡¹ç›®ã€‚å®ƒç±»ä¼¼äºŽåœ¨ React ä¸­å‘åˆ—è¡¨æ·»åŠ é”®ã€‚ åœ¨ SortableGifsContainer ä¸Šï¼Œæˆ‘ä»¬æ·»åŠ äº† axis=&quot;x&quot;ï¼Œæ˜¯å› ä¸º Gif ç»„ä»¶æ˜¯æ°´å¹³æ”¾ç½®çš„ï¼Œå¦‚æžœæƒ³è¦æ°´å¹³æ‹–åŠ¨å®ƒä»¬å°±éœ€è¦é…ç½® axisï¼Œè€Œé»˜è®¤æ˜¯åž‚ç›´æ‹–åŠ¨ã€‚æ¢å¥è¯è¯´ï¼Œ axis=&quot;x&quot; é™åˆ¶å­é¡¹ç›®åªèƒ½æ²¿æ°´å¹³ x è½´æ‹–æ”¾ã€‚åŒæ—¶ï¼Œè¿˜æ·»åŠ äº† onSortEnd={onSortEnd}ï¼Œè¯¥å‡½æ•°åœ¨æ¯æ¬¡æ‹–åŠ¨æˆ–æŽ’åºé¡¹ç›®æ—¶è§¦å‘ã€‚å®ƒçš„å®žçŽ°å¦‚ä¸‹ 1const onSortEnd = (&#123; oldIndex, newIndex &#125;) =&gt; setGifs(arrayMove(gifs, oldIndex, newIndex)); onSortEnd æŽ¥æ”¶äº†ä¸€ä¸ªè¢«æ‹–åŠ¨çš„é¡¹ç›®çš„æ–°æ—§ indexï¼Œå½“ç„¶ï¼Œæ¯æ¬¡æˆ‘ä»¬ç§»åŠ¨é¡¹ç›®åŽï¼Œæˆ‘ä»¬éƒ½ä¼šåœ¨arrayMoveçš„å¸®åŠ©ä¸‹ä¿®æ”¹æ•°æ®ã€‚ çŽ°åœ¨å·²ç»çŸ¥é“å¦‚ä½•åœ¨é¡¹ç›®ä¸­å®žçŽ°æ‹–æ”¾ï¼ ðŸŽ‰ðŸŽ‰ðŸŽ‰ å¦‚æžœæˆ‘ä»¬æœ‰å¤šä¸ªé¡¹ç›®åˆ—è¡¨æ€Žä¹ˆåŠžï¼Ÿä¹‹å‰çš„ä¾‹å­æ˜¯ä¸ºäº†å±•ç¤º react-sortable-hoc çš„åŠŸèƒ½ï¼Œæ‰€ä»¥éžå¸¸çš„æ¸…æ™°ä»¥åŠç®€å•ã€‚ä½†æ˜¯åœ¨å®žé™…çš„ä¸šåŠ¡ä¸­ï¼Œä½ å¯èƒ½ä¼šé‡åˆ°å¤šä¸ªé¡¹ç›®åˆ—è¡¨éƒ½éœ€è¦æ‹–æ”¾çš„åœºæ™¯ï¼Œé‚£è¯¥æ€Žä¹ˆåŠžï¼Ÿ react-sortable-hoc ä¸ºæˆ‘ä»¬æä¾›äº†ä¸€ä¸ª collection prop ç”¨æ¥åŒºåˆ†åˆ—è¡¨ã€‚åœ¨ä¸Šä¸€ä¸ªä¾‹å­çš„åŸºç¡€ä¸Šï¼Œæˆ‘ä»¬æ·»åŠ ä¸€ä¸ªæ–°çš„åˆ—è¡¨ 123456const [newGifs, setNewGifs] = useState([ 'https://media.giphy.com/media/xiOgHgY2ceKhm46cAj/giphy.gif', 'https://media.giphy.com/media/3oKIPuMqYfRsyJTWfu/giphy.gif', 'https://media.giphy.com/media/4ZgLPakqTajjVFOVqw/giphy.gif', 'https://media.giphy.com/media/3o7btXIelzs8nBnznG/giphy.gif',]); å’Œä¹‹å‰ä¸€æ ·ï¼Œé™¤äº†éœ€è¦åœ¨ SortableGif ç»„ä»¶ä¸Šæ·»åŠ  collection props å…·ä½“å¦‚ä¸‹ 123456789101112&lt;h2&gt;Set 2&lt;/h2&gt;&lt;SortableGifsContainer axis="x" onSortEnd=&#123;onSortEnd&#125;&gt; &#123;newGifs.map((gif, i) =&gt; ( &lt;SortableGif index=&#123;i&#125; key=&#123;gif&#125; gif=&#123;gif&#125; collection="newGifs" /&gt; ))&#125;&lt;/SortableGifsContainer&gt; åœ¨ä¹‹å‰çš„ç¬¬ä¸€ä¸ªåˆ—è¡¨ä¸­ä¹Ÿæ·»åŠ ç›¸åº”çš„ collection å±žæ€§ï¼Œä¾‹å¦‚ collection=&quot;gifs&quot; ä¹‹åŽä¿®æ”¹ onSortEnd å‡½æ•°ï¼Œå®ƒçš„å‚æ•°ä¸­ä¼šå¤šä¸€ä¸ª collection 123456789101112const onSortEnd = (&#123; oldIndex, newIndex, collection &#125;) =&gt; &#123; switch(collection) &#123; case 'gifs': setGifs(arrayMove(gifs, oldIndex, newIndex)) break; case 'newGifs': setNewGifs(arrayMove(newGifs, oldIndex, newIndex)) break; default: break; &#125;&#125; ç„¶åŽï¼Œæˆ‘ä»¬å°±å¯ä»¥è‡ªç”±çš„æ‹–æ”¾äº†ã€‚ å¦‚å›¾ä¸­æ‰€ç¤ºï¼Œæˆ‘ä»¬çŽ°åœ¨æœ‰ä¸¤ä¸ªå•ç‹¬çš„ GIF åˆ—è¡¨ï¼Œå¯ä»¥è‡ªç”±æ‹–æ”¾ã€‚è€Œä¸”ï¼Œå®ƒä»¬æ˜¯ç‹¬ç«‹çš„æ„æ€ï¼Œæ¥è‡ªä¸åŒåˆ—è¡¨çš„é¡¹ç›®ä¸ä¼šæ··æ·†ã€‚]]></content>
      <categories>
        <category>web</category>
      </categories>
      <tags>
        <tag>javascript</tag>
        <tag>react</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[npm ci vs. npm install]]></title>
    <url>%2F2019%2F08%2F22%2Finstall%2F</url>
    <content type="text"><![CDATA[ç¿»è¯‘ https://medium.com/better-programming/npm-ci-vs-npm-install-which-should-you-use-in-your-node-js-projects-51e07cb71e26ã€‚ npm æ˜¯ Node.js é¡¹ç›®é»˜è®¤çš„åŒ…ç®¡ç†å™¨ã€‚ ä½¿ç”¨ npm å¯ä»¥è½»æ¾å®‰è£…å’Œæ›´æ–°ä¾èµ–é¡¹ã€‚npmjs ä¸Šåˆ—å‡ºäº†å¯ä»¥ä½¿ç”¨çš„ä¾èµ–é¡¹ï¼ˆä¾‹å¦‚Vue.js æ¡†æž¶ï¼‰ï¼Œç”šè‡³è¿˜æ˜¾ç¤ºäº†å¯ä»¥å¤åˆ¶å¹¶ç²˜è´´åˆ°ç»ˆç«¯çš„å®‰è£…å‘½ä»¤ï¼Œå¦‚npm i vueã€‚ å¦‚æžœä½ å·²ç»ä½¿ç”¨ npm ä¸€æ®µæ—¶é—´äº†ï¼Œé‚£ä¹ˆä½ å°†å¸¸ç”¨ npm installï¼ˆæˆ–æ›´çŸ­çš„ npm iï¼‰æ¥å®‰è£…æˆ–æ›´æ–°ä¾èµ–é¡¹ã€‚ è™½ç„¶è¿™ä¸ªå®‰è£…å‘½ä»¤ä»ç„¶æœ‰æ•ˆï¼Œä½†æ˜¯åœ¨ npm v6 ä¸­è¿˜æ˜¯å¼•å…¥äº†ä¸€ä¸ªæ–°çš„å‘½ä»¤ - npm ciï¼Œé‚£ä¹ˆå®ƒæ˜¯ç”¨æ¥åšä»€ä¹ˆçš„ï¼Ÿä¸Ž npm i åˆæœ‰ä»€ä¹ˆå·®å¼‚ï¼Ÿ . . . npm install (ç®€å†™: npm i)npm installï¼Œæˆ–è€… npm iï¼Œé€šå¸¸æ˜¯ç”¨æ¥å®‰è£…ä¾èµ–é¡¹ï¼š å®ƒå°†ä¼šå®‰è£… Node.js é¡¹ç›®æ‰€æœ‰çš„ä¾èµ–é¡¹ï¼› å¦‚æžœä½¿ç”¨ ^ æˆ– ~ æ¥åŒ¹é…ä¾èµ–é¡¹çš„ç‰ˆæœ¬æ—¶ï¼Œåˆ™ npm å¯èƒ½æ— æ³•å®‰è£…ç¡®åˆ‡ç‰ˆæœ¬ï¼› åˆ©ç”¨ npm install å®‰è£…æ–°ä¾èµ–é¡¹æ—¶ï¼Œä¼šæ›´æ–° package-lock.jsonã€‚ . . . npm ciä½¿ç”¨ npm ciï¼Œä¼šå‘ç”Ÿï¼š å°†ä¼šåˆ é™¤é¡¹ç›®ä¸­çš„ node_modules æ–‡ä»¶å¤¹ï¼› ä¼šä¾ç…§é¡¹ç›®ä¸­çš„ package.json æ¥å®‰è£…ç¡®åˆ‡ç‰ˆæœ¬çš„ä¾èµ–é¡¹ï¼› ä¸åƒ npm installï¼Œnpm ci ä¸ä¼šä¿®æ”¹ä½ çš„ package-lock.jsonã€‚ä½†æ˜¯å®ƒç¡®å®žæœŸæœ›ä½ çš„é¡¹ç›®ä¸­æœ‰ä¸€ä¸ª package-lock.json æ–‡ä»¶ - å¦‚æžœä½ æ²¡æœ‰è¿™ä¸ªæ–‡ä»¶ï¼Œnpm ci å°†ä¸èµ·ä½œç”¨ï¼Œæ­¤æ—¶å¿…é¡»ä½¿ç”¨ npm installã€‚ å¦‚æžœä½ ä½¿ç”¨ npm ciï¼Œä½ å°†èŽ·å¾—å¯é çš„æž„å»ºã€‚ç‰¹åˆ«æ˜¯å½“æ‚¨åœ¨ Jenkins æˆ– GitLab CI ç­‰æŒç»­é›†æˆå·¥å…·ä¸­è¿è¡Œæ—¶ï¼Œè¿™å°†éžå¸¸æœ‰ç”¨ã€‚ . . . npm ci vs. npm Install â€” è¯¥ç”¨å“ªä¸€ä¸ªï¼Ÿå¦‚æžœä½ ä½¿ç”¨ npm v6+ï¼š ä½¿ç”¨ npm install å®‰è£…æ–°çš„ä¾èµ–é¡¹ï¼Œæˆ–æ›´æ–°çŽ°æœ‰çš„ä¾èµ–é¡¹ï¼ˆä¾‹å¦‚ï¼Œä»Žç‰ˆæœ¬1åˆ°ç‰ˆæœ¬2ï¼‰; åœ¨æŒç»­é›†æˆå·¥å…·ä¸­è¿è¡Œæ—¶ä½¿ç”¨ npm ciï¼Œæˆ–è€…æŸäº›ä¸ä¿®æ”¹ package-lock.json çš„æƒ…å†µä¸‹å®‰è£…ä¾èµ–é¡¹ã€‚ å¦‚æžœä½ ä½¿ç”¨ npm v5 æˆ–è€…æ›´ä½Žçš„ç‰ˆæœ¬ï¼š åªèƒ½é€šè¿‡ npm install æ¥å®‰è£…æˆ–è€…æ›´æ–°ä¾èµ–é¡¹ï¼› å°è¯•å‡çº§åˆ°æœ€æ–°çš„ npm ç‰ˆæœ¬ã€‚é™¤äº†npm ci ä¹‹å¤–ï¼Œå®ƒè¿˜å…·æœ‰ npm audit å‘½ä»¤ï¼Œå¯ä»¥æ›´è½»æ¾åœ°è¯†åˆ«å’Œä¿®å¤ä¾èµ–é¡¹çš„å®‰å…¨æ¼æ´žã€‚æ­¤å¤–ï¼Œä½¿ç”¨ npm v6 å®‰è£…ä¾èµ–é¡¹åº”è¯¥æ›´å¿«ã€‚ . . . æ€»ç»“å¦‚æ‚¨æ‰€è§ï¼Œè¿™ä¸¤ä¸ªå‘½ä»¤éƒ½æœ‰å…¶é€‚ç”¨åœ°åœºæ™¯ã€‚å¦‚æžœå¯èƒ½çš„è¯ï¼Œæˆ‘å»ºè®®ä½¿ç”¨ npm ciï¼Œå› ä¸ºå®ƒå¯é åœ°å®Œæˆå®ƒçš„å·¥ä½œï¼Œå¹¶ä½¿ç”¨ npm install æ¥å®‰è£…æ–°çš„ä¾èµ–é¡¹æˆ–æ›´æ–°çŽ°æœ‰çš„ä¾èµ–é¡¹ã€‚]]></content>
      <categories>
        <category>node</category>
      </categories>
      <tags>
        <tag>javascript</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ä¸€è¨€éš¾å°½çš„ JS Coercion]]></title>
    <url>%2F2019%2F08%2F02%2Fjs-coercion%2F</url>
    <content type="text"><![CDATA[é¢˜ç›®æ¥æºï¼šhttp://javascript-puzzlers.herokuapp.com/ã€‚ æ¥æ¥æ¥ï¼Œå°ç«æ±ï¼Œå…ˆç”¨ä¸‹é¢å…­é“é¢˜ç›®æ¥è¯•è¯•æ°´ 1234567let a = [0];if ([0]) &#123; console.log(a == true);&#125; else &#123; console.log("wut");&#125;//log false 12'5' + 3; // log "53"'5' - 3; // log "2" 1234let a = [1,2];let b = [3,4];a + b; // "1,23,4" 1232 == [[[2]]]// log true 12345[] == []// log false[] == ![]// log true 12345678910let a = [1, 2, 3];let b = [1, 2, 3];let c = [1, 2, 4];a == b;a === b;a &gt; c;a &lt; c;// log false, false, false, true ç»†å¿ƒçš„ä½ ä¸€å®šçœ‹å‡ºæ¥äº†ï¼Œä¸Šè¿°äº”é“é¢˜ç›®éƒ½ä¸Ž JS çš„ç±»åž‹ç›¸å…³ï¼Œå†ç»†ä¸€ç‚¹çš„è¯ï¼Œåº”è¯¥æ˜¯ä¸Žç±»åž‹è½¬æ¢ç›¸å…³ã€‚ å¼•ç”¨ You Donâ€™t Know JS çš„ç»“è®ºï¼Œæˆ‘ä»¬å¯ä»¥å°†ç±»åž‹è½¬æ¢åˆ†ä¸ºï¼šéšå¼è½¬æ¢ï¼ˆImplicit coercionï¼‰ã€æ˜¾å¼è½¬æ¢ï¼ˆExplicit coercionï¼‰ã€‚ æ˜¾å¼è½¬æ¢æˆ‘ä»¬ä¸»åŠ¨çš„å°†ä¸€äº›å˜é‡æŒ‰ç…§æˆ‘ä»¬çš„æœŸæœ›è¿›è¡Œè½¬å˜ã€‚é‚£ä¹ˆæœ‰å‡ ç§æ–¹æ³•å‘¢ï¼Ÿ ToNumer å‚è€ƒ https://www.ecma-international.org/ecma-262/5.1/#sec-9.3ã€‚ å…¶ä»–ç±»åž‹è½¬æ¢ä¸º number ç±»åž‹çš„å‡ ç§æ–¹æ³• è¾“å…¥ç±»åž‹ç»“æžœ UndefinedNaN Null+0 Booleanå¦‚æžœå‚æ•°æ˜¯ trueï¼Œç»“æžœä¸º 1ã€‚å¦‚æžœå‚æ•°æ˜¯ falseï¼Œæ­¤ç»“æžœä¸º +0ã€‚ Numberç»“æžœç­‰äºŽè¾“å…¥çš„å‚æ•°ï¼ˆä¸è½¬æ¢ï¼‰ã€‚ Stringstring ---> number Object object ---> number string â€”&gt; number è¿™ä¸ªè¿‡ç¨‹ç±»ä¼¼äºŽåˆ¤æ–­å­—ç¬¦ä¸²æ˜¯å¦ä¸ºä¸€ä¸ªå­—ç¬¦ä¸²æ•°å€¼å¸¸é‡ï¼Œä¾‹å¦‚ 1234567let a = '1'let b = 'hello world'console.log(Number(a)) // 1console.log(Number(b)) // NaNconsole.log(+a) // 1console.log(+b) // NaN å…¶ä¸­ï¼Œåœ¨å¼€æºçš„ JS ç¤¾åŒºä¸­ä¸€èˆ¬å°† + è§†ä¸ºä¸€ä¸ª æ˜Žç¡®çš„ å¼ºåˆ¶è½¬æ¢å½¢å¼ã€‚ åŒæ—¶ï¼Œè¿™ä¸ªè½¬æ¢è¿‡ç¨‹ä¸­ä¹ŸåŒ…å«ç€ä¸€äº›ç»†èŠ‚ï¼Œç±»ä¼¼äºŽ Number(&quot;&quot;) // 0 ç­‰ï¼Œå…·ä½“å¯è§ https://www.ecma-international.org/ecma-262/5.1/#sec-9.3.1ã€‚ Number(a) å¯ä»¥çš„è¯ï¼Œé‚£ä¹ˆ new Number(a) å¯ä»¥ä¹ˆï¼Ÿå¯è§ https://juejin.im/post/5d37adcff265da1bb13f7347ã€‚ object â€”&gt; number è¿™ä¸ªè¿‡ç¨‹å¯ä»¥åˆ†ä¸ºä¸¤éƒ¨ï¼Œobject â€“&gt; ToPrimitive(object) â€“&gt; numberã€‚ ToPrimitive è¿ç®—ç¬¦æŠŠå…¶å€¼å‚æ•°è½¬æ¢ä¸ºéžå¯¹è±¡ç±»åž‹ï¼Œä¹Ÿå°±æ˜¯è°ƒç”¨å…¶å†…éƒ¨çš„ [[DefaultValue]] æ–¹æ³•ã€‚ [[DefaultValue]] (hint) ä¸­ hint ä¸ºæœŸæœ›ç±»åž‹ï¼ˆå¾ˆå…³é”®ï¼‰ï¼š å¦‚æžœ hint ä¸º numberï¼šå…ˆ Object.prototype.valueOf ï¼Œå¦‚æžœç»“æžœä¸ºåŽŸå§‹å€¼ï¼Œåˆ™è¿”å›žï¼Œå¦åˆ™è°ƒç”¨ Object.prototype.toStringï¼› å¦‚æžœ hint ä¸º stringï¼šå…ˆ Object.prototype.toString ï¼Œå¦‚æžœç»“æžœä¸ºåŽŸå§‹å€¼ï¼Œåˆ™è¿”å›žï¼Œå¦åˆ™è°ƒç”¨ Object.prototype.valueOf ã€‚ 1234567var a = &#123; valueOf: function() &#123; return 42; &#125;, toString: function() &#123; return 4; &#125;&#125;;console.log(Number(a)) // 42console.log(String(a)) // 4 ToString https://www.ecma-international.org/ecma-262/5.1/#sec-9.8 è¾“å…¥ç±»åž‹ç»“æžœ Undefined"undefined" Null"null" Booleanå¦‚æžœå‚æ•°æ˜¯ trueï¼Œé‚£ä¹ˆç»“æžœä¸º "true"ã€‚ å¦‚æžœå‚æ•°æ˜¯ falseï¼Œé‚£ä¹ˆç»“æžœä¸º "false"ã€‚ Stringç»“æžœç­‰äºŽè¾“å…¥çš„å‚æ•°ï¼ˆä¸è½¬æ¢ï¼‰ã€‚ Numberè§ number--->string Objectè§ä¸Šæ–‡ã€‚ number â€”&gt; string ä¸Ž string â€”&gt; number ç±»ä¼¼ï¼Œå¤§ä½“ä¸Šæ˜¯å°†å­—ç¬¦ä¸²æ•°å€¼å¸¸é‡è½¬ä¸ºå­—ç¬¦ä¸²ï¼Œå…¶ä¸­æœ‰äº›ç§‘å­¦è®¡æ•°æ³•çš„è½¬åŒ–ç»†èŠ‚ 1String(1e-1) // "0.1" è¿˜æœ‰ä¸€äº› NaN çš„ç»†èŠ‚ï¼Œè§å‚è€ƒã€‚ ToBoolean https://www.ecma-international.org/ecma-262/5.1/#sec-9.2 ç›¸å¯¹äºŽå‰ä¸¤ä¸ªï¼ŒToBoolean çš„è§„åˆ™è¾ƒä¸ºæ˜Žç¡® è¾“å…¥ç±»åž‹ç»“æžœ Undefinedfalse Nullfalse Booleanç»“æžœç­‰äºŽè¾“å…¥çš„å‚æ•°ï¼ˆä¸è½¬æ¢ï¼‰ã€‚ Numberå¦‚æžœå‚æ•°æ˜¯ +0, -0, æˆ– NaNï¼Œç»“æžœä¸º false ï¼›å¦åˆ™ç»“æžœä¸º trueã€‚ Stringå¦‚æžœå‚æ•°å‚æ•°æ˜¯ç©ºå­—ç¬¦ä¸²ï¼ˆå…¶é•¿åº¦ä¸ºé›¶ï¼‰ï¼Œç»“æžœä¸º falseï¼Œå¦åˆ™ç»“æžœä¸º trueã€‚ Objecttrue é™¤äº†å‡ ä¸ªç‰¹æ®Šçš„ undefinedï¼Œnullï¼Œ0ï¼Œ&quot;&quot;ï¼ŒNaNï¼Œå…¶ä»–çš„ä¸€å¾‹è½¬ä¸º trueã€‚ä¸»è¦çš„è½¬æ¢æ–¹æ³•ï¼ŒBoolean ä»¥åŠ !!ã€‚ 123456789101112131415161718192021222324let a = "0";let b = [];let c = &#123;&#125;;let d = "";let e = 0;let f = null;let g;Boolean( a ); // true!!a; // trueBoolean( b ); // true!!a; // trueBoolean( c ); // true!!c; // trueBoolean( d ); // false!!d; // falseBoolean( e ); // false!!e; // falseBoolean( f ); // false!!f; // falseBoolean( g ); // false!!g; // false éšå¼è½¬æ¢ï¼ˆä¸€èˆ¬ä¼´éšç€è¡¨è¾¾å¼ã€æ“ä½œç¬¦ï¼‰å½“æˆ‘ä»¬åœ¨ä½¿ç”¨æ¡ä»¶è¡¨è¾¾å¼æˆ–è€…ä¸€äº›è¿ç®—ã€ç›¸ç­‰æ“ä½œç¬¦æ—¶ï¼Œå¦‚æžœä¸æ³¨æ„ï¼Œå°±ä¼šå‘ç”Ÿéšå¼çš„ç±»åž‹è½¬æ¢ã€‚ åˆ¤æ–­è¯­å¥ä¸»è¦æœ‰ä¸€ä¸‹äº”ç§æƒ…å†µã€‚ åœ¨ä¸€ä¸ªif (..)è¯­å¥ä¸­çš„æ¡ä»¶è¡¨è¾¾å¼ï¼› åœ¨ä¸€ä¸ªfor ( .. ; .. ; .. ) ä¸­é—´çš„æ¡ä»¶è¡¨è¾¾å¼ï¼› åœ¨ while (..) å’Œ do..while(..) å¾ªçŽ¯ä¸­çš„æ¡ä»¶è¡¨è¾¾å¼ï¼› åœ¨? :ä¸‰å…ƒè¡¨è¾¾å¼ä¸­çš„æ¡ä»¶è¡¨è¾¾å¼ï¼ˆç¬¬ä¸€ä¸ªå­å¥ï¼‰ï¼› ||ï¼ˆâ€œé€»è¾‘æˆ–â€ï¼‰å’Œ&amp;&amp;ï¼ˆâ€œé€»è¾‘ä¸Žâ€ï¼‰æ“ä½œç¬¦å·¦æ‰‹è¾¹çš„æ“ä½œæ•°ã€‚ åœ¨æ—¥å¸¸çš„å¼€å‘ä¸­ï¼Œæˆ‘ä»¬é€šå¸¸ä¸ä¼šå°†åˆ¤æ–­è¯­è¯­å¥ä¸­çš„ condition çš„ç»“æžœå¼ºåˆ¶è½¬æ¢ä¸º booleanï¼Œä¾‹å¦‚ 12345678910let a = 42let b = &#123;&#125;if (a) &#123; console.log( "yep" ); // yep&#125;while (b) &#123; console.log( "forever running" );&#125; è¿™æ—¶æˆ‘ä»¬å·²ç»é»˜è®¤ä½¿ç”¨éšå¼è½¬æ¢æ¥ç®€åŒ–ä»£ç ã€‚è€Œåœ¨æ²¡æœ‰é»˜è®¤å‚æ•°çš„ ES5ï¼Œæˆ‘ä»¬ä¹Ÿä¼šä½¿ç”¨ï¼Œæ¥ä¸ºå‡½æ•°æ·»åŠ é»˜è®¤å‚æ•° 1234let a;let b = 42;a || b; // 42 æˆ–è€…åˆ©ç”¨ &amp;&amp; æ¥ç®€åŒ– if è¯­å¥ 1234let a = 42;let b = "abc";a &amp;&amp; b; // "abc" æ‰€ä»¥åœ¨ç¬¬ä¸€é“é¢˜ç›®ä¸­ 12345let a = [0];if ([0]) &#123; console.log(a == true);&#125;// [0] ä¼šè½¬åŒ–ä¸º true +ã€- è¿ç®—ç¬¦ https://www.ecma-international.org/ecma-262/5.1/#sec-11.6.1 æ ¹æ®ES5è¯­è¨€è§„èŒƒï¼Œå¦‚æžœä¸¤ä¸ªæ“ä½œæ•°ä¹‹ä¸€å·²ç»æ˜¯ä¸€ä¸ª stringï¼Œæˆ–è€…ä¸‹åˆ—æ­¥éª¤äº§ç”Ÿä¸€ä¸ª string è¡¨è¾¾å½¢å¼ï¼Œ+ å°†ä¼šè¿›è¡Œè¿žæŽ¥ã€‚ æ‰€ä»¥é¢˜ç›®ä¸­ 1'5' + 3; // log "53" ä½†ï¼Œå¦‚æžœå½“ + çš„ä¸¤ä¸ªæ“ä½œæ•°ä¹‹ä¸€æ”¶åˆ°ä¸€ä¸ªobjectï¼ˆåŒ…æ‹¬arrayï¼‰æ—¶ï¼Œå®ƒé¦–å…ˆåœ¨è¿™ä¸ªå€¼ä¸Šè°ƒç”¨ ToPrimitiveï¼Œä¾‹å¦‚ 1'5' + [1,2,3] // "51,2,3" ä¼šå°† [1,2,3] è½¬ä¸ºäº† string è°ƒç”¨ toStringï¼Œè‡³äºŽåŽŸå› è§ä¸Šæ–‡ã€‚ æ‰€ä»¥ç¬¬ä¸‰é¢˜ç›®ä¸­ï¼Œa å’Œ b åˆ†åˆ«è¢«è½¬åŒ–ä¸º &quot;1,2&quot; ä»¥åŠ &quot;3,4&quot; 1234let a = [1,2];let b = [3,4];a + b; // "1,23,4" è€Œä¸€å…ƒ - è¿ç®—ç¬¦å°†å…¶æ“ä½œæ•°è½¬æ¢ä¸º number ç±»åž‹ï¼Œæ‰€ä»¥ 1'5' - 3; // log 2 == ä»¥åŠ === ç›¸ç­‰æ“ä½œç¬¦ https://www.ecma-international.org/ecma-262/5.1/#sec-11.9.1 æœ€ä¸ºå¸¸è€ƒï¼Œå¼€å‘ç”¨çš„å°‘ï¼Œé¢è¯•ç”¨çš„å¤šçš„ == æ¥äº†ï¼Œè¿™é‡Œå¼•ç”¨ä¸€å¥You Donâ€™t Know JS ä¸­çš„ä¸€å¥è¯ â€œ== allows coercion in the equality comparison and === disallows coercion.â€ == ä¸Ž === çš„æœ¬è´¨åŒºåˆ«åœ¨ä¸Ž coercion ä¹Ÿå°±æ˜¯è¯´æœ¬è´¨åœ¨äºŽæ˜¯å¦å‘ç”Ÿäº†å¼ºåˆ¶ç±»åž‹è½¬æ¢ã€‚é‚£ä¹ˆ == æ˜¯å¦‚ä½•è½¬åŒ–ç±»åž‹çš„å‘¢ï¼Ÿ ä»¥ x == y ä¸ºä¾‹ï¼ˆç¯‡å¹…æ‰€é™çœç•¥ï¼Œxã€y ç±»åž‹ç›¸åŒçš„è§„åˆ™ï¼Œè§å‚è€ƒåœ°å€ï¼‰ x ä¸º null ä¸” y ä¸º undefinedï¼Œ è¿”å›ž true; x ä¸º undefined ä¸” y ä¸º nullï¼Œè¿”å›ž true; è‹¥ Type(x) ä¸º number ä¸” Type(y) ä¸º stringï¼Œè¿”å›ž x == ToNumber(y) çš„ç»“æžœ; Type(x) ä¸º string ä¸” Type(y) ä¸º numberï¼Œè¿”å›ž ToNumber(x) == yçš„ç»“æžœ; Type(x) ä¸º booleanï¼Œè¿”å›ž ToNumber(x) == y çš„ç»“æžœ; Type(y) ä¸º booleanï¼Œè¿”å›ž x == ToNumber(y) çš„ç»“æžœ; Type(x) ä¸º string æˆ– numberï¼Œä¸” Type(y) ä¸º objectï¼Œè¿”å›ž x == ToPrimitive(y) çš„ç»“æžœ; Type(x) ä¸º object ä¸” Type(y) ä¸º string æˆ– numberï¼Œ è¿”å›žæ¯”è¾ƒToPrimitive(x) == y çš„ç»“æžœã€‚ çœ‹ä¼¼å¾ˆå¤šï¼Œå…¶å®žæœ¬è´¨ä¸Šæ»¡è¶³ä¸¤æ¡ï¼š å¦‚æžœ xï¼Œy çš„ç±»åž‹ä¸ºéžå¼•ç”¨ç±»åž‹ï¼Œå°†å…¶è½¬åŒ–ä¸º number è¿›è¡Œå¯¹æ¯”ï¼› å¦‚æžœ xï¼Œy çš„ç±»åž‹ä¸ºå¼•ç”¨ç±»ï¼Œå°†è°ƒç”¨ ToPrimitive è½¬åŒ–ä¸ºåŸºç¡€å€¼è¿›è¡Œå¯¹æ¯”ã€‚ 1232 == '2' // true1 == true // true0 == false // true è€Œé¢˜ç›®ä¸­ï¼Œ[[[2]]] éœ€è¦èŽ·å– ToPrimitive çš„ç»“æžœ 12342 == [[[2]]]// [[[2]]] è°ƒç”¨ valueOf() å¾—åˆ° [Array(1)] éžåŸºç¡€ç±»åž‹// [[[2]]] è°ƒç”¨ toString() å¾—åˆ° 2// log true 123456789[] == []// [] ä¸Ž [] ç±»åž‹éƒ½ä¸º objectï¼Œæ‰€ä»¥æ¯”å¯¹æ˜¯å¦å¼•ç”¨åŒä¸€ä¸ªå¯¹è±¡// false[] == ![]// ![] å¼ºåˆ¶è½¬åŒ–ä¸º booleanï¼Œfalseï¼Œ// ![] è½¬åŒ–ä¸º booleanï¼Œæ‰€ä»¥ [] éœ€è¦åˆ©ç”¨ ToPrimitive å¾—åˆ° ""// åŽŸå¼å˜ä¸º "" == falseï¼Œfalse è½¬åŒ–ä¸º 0ï¼Œè€Œ "" ä¹Ÿå˜ä¸º 0// log true åŒæ ·è¿˜æœ‰ &gt;ï¼Œ&lt; https://www.ecma-international.org/ecma-262/5.1/#sec-11.8 12345678910let a = [1, 2, 3];let b = [1, 2, 3];let c = [1, 2, 4];a == b; // éžåŒä¸€å¼•ç”¨a === b; // éžåŒä¸€å¼•ç”¨a &gt; c; // a è½¬åŒ–ä¸º "1,2,3"ï¼Œc è½¬åŒ–ä¸º "1,2,4"a &lt; c;// log false, false, false, true]]></content>
      <categories>
        <category>web</category>
      </categories>
      <tags>
        <tag>javascript</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[åˆ©ç”¨ Profiler åˆ†æž Vue Render æ€§èƒ½é—®é¢˜]]></title>
    <url>%2F2019%2F07%2F30%2Fprofile-analyse-vue%2F</url>
    <content type="text"><![CDATA[æœ€è¿‘åœ¨å¼€å‘ä¸€å¥—ç»„ä»¶åº“ï¼ŒæœŸé—´åœ¨å®žçŽ°InputNumber ç»„ä»¶æ—¶å€™ç¢°åˆ°ä¸€ä¸ªè¯¡å¼‚å¡é¡¿çš„çŽ°è±¡ï¼Œç”¨äº†æ—¶é—´æ¥æŽ’é™¤è¿™ä¸ªé—®é¢˜ï¼Œæ¶‰åŠåˆ°ä¸€äº›é—®é¢˜å®šä½çš„æ–¹æ³•ï¼Œè®°å½•ä¸‹æ¥å·²å¤‡åŽç”¨ã€‚ 1. å‘çŽ°é—®é¢˜åœ¨å®žçŽ° InputNumber ç»„ä»¶çš„æ—¶å€™ï¼Œæœ‰ä¸€ä¸ªåŠŸèƒ½æ˜¯æŒ‰ä½ + æˆ– - æŒ‰é’®æ—¶ï¼Œç»„ä»¶çš„å€¼åœ¨ä¸æ–­çš„è‡ªå¢žæˆ–è€…è‡ªå‡ï¼Œå½“ç»„ä»¶çš„å€¼è‡ªå¢žåˆ°ä¸€å®šæ•°é‡ä¹‹åŽï¼Œç»„ä»¶ä¼šå¼€å§‹å¡é¡¿ï¼Œå¹¶ä¸”é¡µé¢ä¸Šä¸‹æ»šåŠ¨ä¹Ÿä¼šæœ‰æ˜Žæ˜¾çš„å»¶è¿Ÿã€‚ é—®é¢˜ä½“éªŒ ç›¸å…³ä»£ç  2. å®šä½é—®é¢˜12345678910111213141516171819202122232425262728&lt;script&gt;export default &#123; name: "input-number", ... methods: &#123; handleClick(type) &#123; const &#123; step &#125; = this; const period = 10; const timerHandle = () =&gt; &#123; const &#123; addDisabled, decDisabled &#125; = this; if (!addDisabled &amp;&amp; type === "add") this.inputNumberValue += step; if (!decDisabled &amp;&amp; type === "dec") this.inputNumberValue -= step; &#125;; const timer = setInterval(timerHandle, period); const startTime = new Date(); const handler = () =&gt; &#123; const endTime = new Date(); if (endTime - startTime &lt; period) timerHandle(); clearInterval(timer); document.removeEventListener("mouseup", handler, false); &#125;; document.addEventListener("mouseup", handler, false); &#125; ...&#125;;&lt;/script&gt; é¦–å…ˆå®šä½é—®é¢˜å‘ç”Ÿçš„ä½ç½®ï¼Œç›´è§‚ä¸Šæ„Ÿå—åº”è¯¥æ˜¯ç‚¹å‡»ä¹‹åŽä¸æ— ç«¯è‡ªå¢žå‘ç”Ÿçš„å¡é¡¿ï¼Œå¯¹åº”ä»£ç ä¸­çš„ handleClick å‡½æ•°ï¼Œå®ƒå°† click äº‹ä»¶åˆ†ä¸º mousedown ä»¥åŠ mouseupï¼Œå½“è§¦å‘ mousedown äº‹ä»¶æ—¶å€™ï¼Œè°ƒç”¨ä¸€ä¸ª setInterval å®šæ—¶æ‰§è¡Œç»„ä»¶å€¼å˜åŒ–çš„å‡½æ•°ã€‚ åˆæ­¥å®šä½é—®é¢˜åº”è¯¥å°±å‘ç”Ÿåœ¨ timerHandle ä¹‹åŽï¼Œå½“ inputNumberValue å‘ç”Ÿå˜åŒ–ä¹‹åŽï¼Œå®ƒä¼šæŒ‰ç…§ä¸€å®šçš„è§„åˆ™æ¥æ”¹å˜ inputValue çš„å€¼ï¼Œä»Žè€Œè§¦å‘ $emit(input, this.inputValue) æ¥å®Œæˆ v-modelã€‚ 1234567891011121314151617181920212223computed: &#123; inputNumberValue: &#123; get() &#123; return this.inputValue; &#125;, set(value) &#123; // ...ä¸€å®šè§„åˆ™ this.inputValue = limits.find(limit =&gt; limit.need(value)).value; &#125; &#125;&#125;,watch: &#123; value: &#123; handler(newVal) &#123; console.timeEnd() this.inputNumberValue = newVal; &#125;, immediate: true &#125;, inputValue(newVal) &#123; this.$emit("input", newVal); &#125;&#125; åˆ©ç”¨ console.time ä»¥åŠ console.timeEnd æ¥æŽ’æŸ¥ï¼Œé‚£ä¸€æ­¥å‘ç”Ÿçš„å¡é¡¿ï¼Œæ£€æµ‹æ•´ä¸ª v-model å˜åŒ–çš„æµç¨‹ã€‚ ä¹Ÿå°±æ˜¯åœ¨ timerHandle ä»¥åŠ watch value handler å†…æ·»åŠ  console.time ä»¥åŠ console.timeEnd ï¼Œå…·ä½“å¦‚ä¸‹ 12345678910111213141516const timerHandle = () =&gt; &#123; const &#123; addDisabled, decDisabled &#125; = this; if (!addDisabled &amp;&amp; type === "add") this.inputNumberValue += step; if (!decDisabled &amp;&amp; type === "dec") this.inputNumberValue -= step; console.time();&#125;;watch: &#123; value: &#123; handler(newVal) &#123; console.timeEnd() this.inputNumberValue = newVal; &#125;, immediate: true &#125;&#125; ç„¶åŽè¿è¡Œï¼Œå‘çŽ°è¿è¡Œæ—¶é—´æ˜¯åœ¨ä¸æ–­åœ°å¢žåŠ çš„ï¼Œè¿™æ—¶å€™é—®é¢˜çš„å¯ä»¥å½’ç±»ä¸ºï¼ŒinputNumber ç»„ä»¶çš„å€¼åœ¨ä¸æ–­åœ°å˜åŠ¨ï¼Œå¯¼è‡´çš„ update çš„æ—¶é—´ä¼šä¸æ–­åœ°å¢žé•¿ã€‚ æŽ¥ä¸‹æ¥è¦åˆ¤æ–­å…·ä½“æ˜¯å“ªä¸€å¥jså¯¼è‡´æ•´ä¸ªé¡µé¢çš„ update æ—¶é—´ä¸æ–­åœ°å˜é•¿ï¼Œåˆ©ç”¨ Chrome çš„ JavaScript Profiler æ¥å®Œæˆè¯¥å·¥ä½œã€‚æ‰“å¼€å¼€å‘è€…å·¥å…· åˆ©ç”¨è¿™ä¸ªé¢æ¿ä½ å¯ä»¥è¿½è¸ªç½‘é¡µç¨‹åºçš„å†…å­˜æ³„æ¼é—®é¢˜ï¼Œè¿›ä¸€æ­¥æå‡ç¨‹åºçš„JavaScriptæ‰§è¡Œæ€§èƒ½ï¼Œç‚¹å‡»Start æŒ‰é’®ï¼Œç„¶åŽåŽ»å¤çŽ°åˆšæ‰çš„æ“ä½œï¼Œå¾—åˆ°ç»“æžœå¦‚ä¸‹ å›¾ä¸­æ ‡è¯†å¤„æœ‰ä¸‰ä¸ªæ¨¡å¼ï¼š Chart æŒ‰æ—¶é—´å…ˆåŽé¡ºåºæ˜¾ç¤ºçš„ç«ç„°å›¾ï¼› Heavy(Bottom Up) æ ¹æ®å¯¹æ€§èƒ½çš„æ¶ˆè€—å½±å“åˆ—å‡ºæ‰€æœ‰çš„å‡½æ•°ï¼Œå¹¶å¯ä»¥æŸ¥çœ‹è¯¥å‡½æ•°çš„è°ƒç”¨è·¯å¾„ï¼› Tree(Top Down) ä»Žè°ƒç”¨æ ˆçš„é¡¶ç«¯ï¼ˆæœ€åˆè°ƒç”¨çš„ä½ç½®ï¼‰å¼€å§‹ï¼Œæ˜¾ç¤ºè°ƒç”¨ç»“æž„çš„æ€»ä½“çš„æ ‘çŠ¶å›¾æƒ…å†µã€‚ é€‰æ‹© Tree(Top Down) æ¨¡å¼ï¼Œå¾—åˆ°ç»“æžœå¦‚ä¸‹ å¯ä»¥çœ‹å‡º flushCallbacksvue å‡½æ•°å ç”¨äº†74.66%çš„ Total Timeï¼Œæ‰€ä»¥éœ€è¦å¯¹å®ƒè¿›è¡Œåˆ†æž åœ¨å®ƒçš„è°ƒç”¨æ ˆä¸­ï¼Œå…³é”®çš„ä¸€æ­¥æ˜¯ Vue._update ï¼Œå®ƒçš„ä¸»è¦åŠŸèƒ½æ˜¯å°† Vnode æ¸²æŸ“æˆçœŸå®žDOMï¼Œæ‰€ä»¥ä¸Šè¿°çš„å¡é¡¿é—®é¢˜æžœç„¶å‡ºçŽ°åœ¨æ¸²æŸ“è¿™ä¸€æ­¥ã€‚ ç»§ç»­åˆ†æžï¼Œå‘çŽ°ä¸»è¦é—®é¢˜åœ¨ä¸Ž updateDirctives è¿™ä¸ªå‡½æ•°å†…ï¼Œçœ‹æ¥é—®é¢˜å’ŒæŒ‡ä»¤çš„æ›´æ–°ç›¸å…³ã€‚ æœ€åŽï¼Œå‘çŽ°åŽŸæ¥æ˜¯ highlightBlock çš„é”…ï¼Œå› ä¸ºè¦å®Œæˆé¡µé¢ä¸­ä»£ç é«˜äº®çš„éœ€æ±‚ï¼Œå¼€å‘äº†ä¸€ä¸ªæŒ‡ä»¤ 12345678import hljs from 'highlight.js/lib/highlight';Vue.directive ('highlight', function (el) &#123; let blocks = el.querySelectorAll ('code'); Array.prototype.forEach.call (blocks, block =&gt; &#123; hljs.highlightBlock (block); &#125;);&#125;); å½“ InputNumber ç»„ä»¶ v-model æ‰€ç»‘å®šçš„çˆ¶ç»„ä»¶ data å˜åŠ¨æ—¶å€™ï¼Œä¼šå¯¼è‡´ v-highlight æŒ‡ä»¤ä¸æ–­åœ°æ›´æ–°ï¼Œä½¿å¾—é¡µé¢å¡é¡¿ã€‚ 3. è§£å†³é—®é¢˜åªéœ€è¦å°†è¯¥æŒ‡ä»¤çš„é«˜äº®ä»£ç çš„å‡½æ•°å†™åœ¨ bind é‡Œé¢ï¼Œè¿™æ ·å°±åªè°ƒç”¨ä¸€æ¬¡ï¼ŒæŒ‡ä»¤ç¬¬ä¸€æ¬¡ç»‘å®šåˆ°å…ƒç´ æ—¶è°ƒç”¨ã€‚ 12345678Vue.directive ('highlight', &#123; bind (el) &#123; let blocks = el.querySelectorAll ('code'); Array.prototype.forEach.call (blocks, block =&gt; &#123; hljs.highlightBlock (block); &#125;); &#125;&#125;); æ¬¢è¿ŽStarï¼šhttps://github.com/FatGe/FatGe.github.io]]></content>
      <categories>
        <category>chrome</category>
      </categories>
      <tags>
        <tag>vue</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[React v16 ç”Ÿå‘½å‘¨æœŸå‡½æ•°è¯¦è§£ï¼šå¦‚ä½•ã€ä½•æ—¶ä½¿ç”¨å®ƒä»¬ï¼ˆReact ç»„ä»¶ç”Ÿå‘½å‘¨æœŸçš„ä¿®è®¢å’Œæœ€æ–°æŒ‡å—ï¼‰]]></title>
    <url>%2F2019%2F07%2F26%2Freact-lifecycle%2F</url>
    <content type="text"><![CDATA[ç¿»è¯‘è‡ª React 16 Lifecycle Methods: How and When to Use Themï¼Œä½œè€…ï¼šScott Domes å‚è€ƒ React.Component æ¦‚è¿°ï¼šæœ€è¿‘åœ¨å­¦ä¹  react v16.8.4ï¼Œå‘çŽ°ç»„ä»¶çš„ç”Ÿå‘½å‘¨æœŸå‘ç”Ÿäº†ä¸€äº›å˜åŒ–ï¼ŒåŽŸæœ‰çš„ä¸€äº›æ–¹æ³•è¢«åºŸå¼ƒï¼Œæ‰€ä»¥çœ‹äº†å®˜æ–¹APIä»‹ç»ï¼Œå†ç»“åˆä¸Šè¿°æ–‡ç« ï¼Œåšä¸ªæ€»ç»“ã€‚ ç”±äºŽè¿™æ¬¡ç”Ÿå‘½å‘¨æœŸ API æœ‰ç‚¹å¤æ‚ï¼Œæˆ‘å°†è¿™äº›æ–¹æ³•åˆ†ä¸ºå››ä¸ªéƒ¨åˆ†ï¼šå®‰è£…ï¼ˆMountingï¼‰ï¼Œæ›´æ–°ï¼ˆUpdatingï¼‰ï¼Œå¸è½½ï¼ˆUnmountingï¼‰å’Œå¼‚å¸¸ï¼ˆErrorï¼‰ã€‚ Mounting - ç»„ä»¶çš„æŒ‚è½½â”œâ”€â”€ constructor â”œâ”€â”€ static getDerivedStateFromProps â”œâ”€â”€ render â”œâ”€â”€ componentDidMount constructor å¦‚æžœæ‚¨çš„ç»„ä»¶æ˜¯ Class Componentï¼Œåˆ™è°ƒç”¨çš„ç¬¬ä¸€å°±æ˜¯ç»„ä»¶æž„é€ å‡½æ•°ã€‚ è¿™ä¸é€‚ç”¨äºŽ Functional Componentã€‚ ç›¸å…³æž„é€ å‡½æ•°å¯èƒ½æ˜¯å¦‚ä¸‹å½¢å¼ 12345678class MyComponent extends Component &#123; constructor(props) &#123; super(props); this.state = &#123; counter: 0, &#125;; &#125;&#125; æž„é€ å‡½æ•°çš„å‚æ•°ä¸º propsï¼Œä½ å¯ä»¥åˆ©ç”¨ super æ¥ä¼ å…¥ã€‚ åœ¨æž„é€ å‡½æ•°ä¸­ï¼Œä½ å¯ä»¥åˆå§‹åŒ– stateã€è®¾å®šé»˜è®¤å€¼ã€‚ç”šè‡³ä½ å¯ä»¥ä¾æ® props æ¥åˆ›å»º stateã€‚ 12345678class MyComponent extends Component &#123; constructor(props) &#123; super(props); this.state = &#123; counter: props.initialCounterValue, &#125;; &#125;&#125; æ³¨æ„ï¼ŒçŽ°åœ¨æž„é€ å‡½æ•°æ˜¯å¯é€‰çš„ï¼Œå¦‚æžœæ‚¨çš„ Babel è®¾ç½®æ”¯æŒ class fieldsï¼Œå°±å¯ä»¥åƒè¿™æ ·åˆå§‹åŒ–çŠ¶æ€ï¼š 12345class MyComponent extends Component &#123; state = &#123; counter: 0, &#125;;&#125; è¿™ç§æ–¹æ³•æ˜¯è¢«å¤§å®¶æ‰€æå€¡çš„ã€‚ ä½ ä»ç„¶å¯ä»¥æ ¹æ® props åˆ›å»º stateï¼š 12345class MyComponent extends Component &#123; state = &#123; counter: this.props.initialCounterValue, &#125;;&#125; ä½†æ˜¯ï¼Œå¦‚æžœéœ€è¦ä½¿ç”¨ ref ï¼Œå°±ä»éœ€è¦æž„é€ å‡½æ•°ã€‚ 12345678910class Grid extends Component &#123; constructor(props) &#123; super(props); this.state = &#123; blocks: [], &#125;; // åœ¨ constructor ä¸­åˆ›å»º ref this.grid = React.createRef(); &#125;&#125; æˆ‘ä»¬éœ€è¦æž„é€ å‡½æ•°æ¥è°ƒç”¨ createRefï¼Œä»¥åˆ›å»ºå¯¹ HTMLElement å…ƒç´ çš„å¼•ç”¨ã€‚è¿˜å¯ä»¥ä½¿ç”¨æž„é€ å‡½æ•°è¿›è¡Œå‡½æ•°ç»‘å®šï¼Œè¿™ä¹Ÿæ˜¯å¯é€‰çš„ 123456789101112class Grid extends Component &#123; constructor(props) &#123; super(props); this.state = &#123; blocks: [], &#125;; // 1 this.handleChange.bind(this) &#125; // 2 ç­‰åŒäºŽ 1 handleChange = () =&gt; &#123;&#125;&#125; constructoræ€»ç»“ï¼š æž„é€ å‡½æ•°çš„æœ€å¸¸æ³•ï¼šè®¾ç½® stateï¼Œåˆ›å»º ref å’Œæ–¹æ³•ç»‘å®šã€‚ getDerivedStateFromProps æŒ‚è½½æ—¶ï¼ŒgetDerivedStateFromProps æ˜¯æ¸²æŸ“å‰è°ƒç”¨çš„æœ€åŽä¸€ä¸ªæ–¹æ³• ä¸€èˆ¬ä½¿ç”¨ getDerivedStateFromProps å¯ä»¥æ ¹æ®åˆå§‹ props ä½¿ç”¨å®ƒæ¥è®¾ç½®çŠ¶æ€ã€‚ 12345static getDerivedStateFromProps(props, state) &#123; return &#123; blocks: createBlocks(props.numberOfBlocks) &#125;;&#125;// log &#123;blocks: Array(20)&#125;console.log(this.state); ä¸Šè¿°ä»£ç ä¸­ä¾æ® props.numberOfBlocks æ¥åˆå§‹åŒ–æœŸæœ›çš„ stateï¼ˆå‡½æ•°returnä¸ºçŠ¶æ€ï¼‰ã€‚ æ³¨æ„ï¼š æˆ‘ä»¬å¯ä»¥å°†æ­¤ä»£ç æ”¾åœ¨ constructor ä¸­ï¼Œä¸Žä¹‹ç›¸ getDerivedStateFromPropsçš„ä¼˜ç‚¹æ˜¯å®ƒæ›´ç›´è§‚ - å®ƒä»…ç”¨äºŽè®¾ç½®çŠ¶æ€ï¼Œè€Œæž„é€ å‡½æ•°æœ‰å¤šç§ç”¨é€”ã€‚ æ€»ç»“ï¼š getDerivedStateFromProps çš„æœ€å¸¸è§ç”¨ä¾‹ï¼ˆåœ¨mountæœŸé—´ï¼‰ï¼šæ ¹æ®åˆå§‹propsè¿”å›žçŠ¶æ€å¯¹è±¡ã€‚ renderå®Œæˆæ‰€æœ‰æ¸²æŸ“çš„å·¥ä½œã€‚å®ƒè¿”å›žå®žé™…ç»„ä»¶çš„ JSXï¼Œä½¿ç”¨Reactæ—¶ï¼Œå°†èŠ±è´¹å¤§éƒ¨åˆ†æ—¶é—´åœ¨è¿™é‡Œã€‚ æ¸²æŸ“çš„æœ€å¸¸è§ç”¨ä¾‹ï¼šè¿”å›ž JSX ç»„ä»¶ã€‚ componentDidMount åœ¨ç¬¬ä¸€æ¬¡æ¸²æŸ“ç»„ä»¶ä¹‹åŽï¼Œè§¦å‘æ­¤æ–¹æ³•ã€‚ å¦‚æžœéœ€è¦åŠ è½½æ•°æ®ï¼Œè¯·åœ¨æ­¤å¤„æ‰§è¡Œã€‚ ä¸è¦å°è¯•åœ¨ constructor ä¸­åŠ è½½æ•°æ®æˆ–æ¸²æŸ“ï¼ŒåŽŸå› ï¼Œreact-interview-questions. ç”±äºŽAJAXæ˜¯å¼‚æ­¥çš„ï¼Œæ‰€ä»¥æ— æ³•ä¿è¯åœ¨ç»„ä»¶æŒ‚è½½ä¹‹å‰ AJAX è¯·æ±‚å®Œæˆè§£æžã€‚ å¦‚æžœç¡®å®žå¦‚æ­¤ï¼Œé‚£å°±æ„å‘³ç€ä½ è¦åœ¨æœªæŒ‚è½½çš„ç»„ä»¶ä¸Šå°è¯• setStateï¼Œè¿™ä¸ä»…ä¸èµ·ä½œç”¨ï¼Œè€Œä¸” React æŠ¥é”™ã€‚ åœ¨componentDidMountä¸­æ‰§è¡Œ AJAX å°†ä¿è¯æœ‰ä¸€ä¸ªè¦æ›´æ–°çš„ç»„ä»¶ã€‚ componentDidMount è§¦å‘æ—¶ï¼Œç»„ä»¶å·²å®Œæˆç¬¬ä¸€ renderï¼Œæ‰€ä»¥å¯ä»¥è¿›è¡Œä¸€äº›æ“ä½œï¼š åœ¨åˆšåˆšæ¸²æŸ“çš„ &lt;canvas&gt; å…ƒç´ ä¸Šè¿›è¡Œç»˜åˆ¶ è®¿é—® DOM èŠ‚ç‚¹ æ·»åŠ äº‹ä»¶ä¾¦å¬å™¨ åŸºæœ¬ä¸Šï¼Œåœ¨è¿™é‡Œä½ å¯ä»¥åšæ‰€æœ‰ä¾èµ– DOM çš„è®¾ç½®ï¼Œå¹¶å¼€å§‹èŽ·å¾—ä½ éœ€è¦çš„æ‰€æœ‰æ•°æ®ï¼Œä¾‹å¦‚ 123456789componentDidMount() &#123; // åˆ©ç”¨ ref è®¿é—® dom å…ƒç´  this.bricks = initializeGrid(this.grid.current); this.interval = setInterval(() =&gt; &#123; // ajax èŽ·å–æ•°æ® this.addBlocks(); &#125;, 2000); &#125;&#125; æ€»ç»“ï¼š è°ƒç”¨ AJAX ä»¥åŠ è½½ç»„ä»¶çš„æ•°æ®ã€‚ Updating - ç»„ä»¶çš„æ›´æ–°â”œâ”€â”€ static getDerivedStateFromProps â”œâ”€â”€ shouldComponentUpdate â”œâ”€â”€ render â”œâ”€â”€ getSnapshotBeforeUpdate â”œâ”€â”€ componentDidUpdate getDerivedStateFromProps æ˜¯çš„ï¼Œå†æ¥ä¸€æ¬¡ã€‚ çŽ°åœ¨ï¼Œå®ƒæ›´æœ‰ç”¨äº†ã€‚ å¦‚æžœæ‚¨éœ€è¦æ ¹æ® props æ¥æ›´æ–° stateï¼Œå¯ä»¥é€šè¿‡ return æ–°çš„çŠ¶æ€å¯¹è±¡æ¥å®Œæˆè¯¥ä»»åŠ¡ã€‚ æ³¨ï¼Œä¸å»ºè®®ä¾æ® props æ¥å¤„ç† stateï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œåªæœ‰é€¼ä¸å¾—å·²æ‰ä½¿ç”¨è¯¥æ–¹æ³•ã€‚ ä»¥ä¸‹æ˜¯ä¸€äº›ä¾‹å­ï¼š å½“ video ã€audio çš„ source æ”¹å˜æ—¶ï¼Œéœ€è¦é‡ç½®å…ƒç´ ï¼› Server èµ„æºæ›´æ–°åŽéœ€è¦æ¢å¤ UI å…ƒç´ ï¼› å½“å†…å®¹æ”¹å˜æ—¶å…³é—­ç›¸å…³å…ƒç´ ã€‚ å³ä½¿æœ‰ä¸Šè¿°æƒ…å†µï¼Œé€šå¸¸ä¹Ÿæœ‰æ›´å¥½çš„æ–¹æ³•ã€‚ ä½†æ˜¯ getDerivedStateFromProps å¯ä»¥æƒ…å†µå˜å¾—æ›´åã€‚ æ€»ç»“ï¼š getDerivedStateFromProps ä¸€èˆ¬ç”¨äºŽ props ä¸è¶³ä»¥æ”¯æ’‘ä¸šåŠ¡æ—¶ï¼Œåˆ©ç”¨å®ƒæ¥æ›´æ–° stateã€‚ shouldComponentUpdate å…¸åž‹çš„ React å“²å­¦ï¼Œå½“ä¸€ä¸ªç»„ä»¶æ”¶åˆ°æ–°çš„ State æˆ– Propsæ—¶ï¼Œå®ƒåº”è¯¥æ›´æ–°ã€‚ ä½†æˆ‘ä»¬çš„ç»„ä»¶æœ‰ç‚¹å›°æƒ‘ï¼Œå®ƒä¸ç¡®å®šæ˜¯å¦è¦è¿›è¡Œæ›´æ–°ã€‚ shouldComponentUpdate æ–¹æ³•çš„ç¬¬ä¸€ä¸ªå‚æ•°ä¸º nextPropsï¼Œç¬¬äºŒä¸ªå‚æ•°ä¸º nextStateã€‚shouldComponentUpdate è¿”å›žä¸€ä¸ªå¸ƒå°”å€¼ï¼Œç”¨äºŽæŽ§åˆ¶ç»„ä»¶æ˜¯å¦æ›´æ–°ã€‚ shouldComponentUpdate èµ‹äºˆæˆ‘ä»¬ä¸€é¡¹èƒ½åŠ›ï¼Œåªæœ‰åœ¨ä½ å…³å¿ƒçš„ props æ”¹å˜æ—¶ç»„ä»¶ä¼šæ‰æ›´æ–°ã€‚ æ€»ç»“ï¼š å¯ä»¥å‡†ç¡®åœ°æŽ§åˆ¶ç»„ä»¶é‡æ–°æ¸²æŸ“çš„æ—¶é—´ï¼Œå¸¸ç”¨äºŽä¼˜åŒ– Reactï¼Œå…·ä½“ã€‚ render - åŒä¸ŠgetSnapshotBeforeUpdate æ–°æ·»åŠ çš„æ–¹æ³•ï¼Œè§¦å‘æ—¶åˆ»åœ¨ render ä¹‹åŽï¼Œæœ€æ–°çš„æ¸²æŸ“è¾“å‡ºæäº¤ç»™ DOM ä¹‹å‰ã€‚ è°ƒç”¨æ¸²æŸ“å’Œæœ€åŽæ˜¾ç¤ºæ›´æ”¹ä¹‹é—´å¯èƒ½ä¼šæœ‰å»¶è¿Ÿï¼Œ å¦‚æžœä½ éœ€è¦èŽ·å– DOM æ”¹å˜ä¹‹å‰çš„ä¸€äº›ä¿¡æ¯æ—¶ï¼Œå¯ä»¥åˆ©ç”¨è¿™ä¸ªé’©å­å‡½æ•°ã€‚ ä»Žæ¸²æŸ“åˆ°æäº¤è¿™ä¸ªè¿‡ç¨‹æ˜¯å¼‚æ­¥çš„ï¼Œæ‰€ä»¥å¦‚æžœåœ¨ componentWillUpdate è®¿é—® DOM ä¿¡æ¯ï¼Œåœ¨ componentDidUpdate ä½¿ç”¨æ—¶ï¼Œè¯¥ä¿¡æ¯å¯èƒ½å‘ç”Ÿäº†ä¿®æ”¹ï¼Œè¿™ä¸€éƒ¨åˆ†ä»¥å®˜ç½‘çš„ä¾‹å­æ¥è¯´æ˜Ž 123456789101112131415161718192021222324252627class ScrollingList extends React.Component &#123; listRef = React.createRef(); getSnapshotBeforeUpdate(prevProps, prevState) &#123; // å¦‚æžœåœ¨åˆ—è¡¨ä¸­æ·»åŠ æ–°é¡¹ç›® // èŽ·å–åˆ—è¡¨çš„å½“å‰é«˜åº¦ï¼Œä»¥ä¾¿æˆ‘ä»¬ç¨åŽè°ƒæ•´æ»šåŠ¨ if (prevProps.list.length &lt; this.props.list.length) &#123; return this.listRef.current.scrollHeight; &#125; return null; &#125; componentDidUpdate(prevProps, prevState, snapshot) &#123; // å¦‚æžœæˆ‘ä»¬ snapshot çš„å€¼ä¸ä¸ºç©ºï¼Œè¯´æ˜Žæ·»åŠ äº†æ–°é¡¹ç›® // è°ƒæ•´æ»šåŠ¨ï¼Œä»¥ä¾¿è¿™äº›æ–°é¡¹ç›®ä¸ä¼šå°†æ—§é¡¹ç›®æŽ¨å‡ºå¯è§†åŒºåŸŸ if (snapshot !== null) &#123; this.listRef.current.scrollTop += this.listRef.current.scrollHeight - snapshot; &#125; &#125; render() &#123; return ( &lt;div ref=&#123;this.listRef&#125;&gt;&#123;/* ...contents... */&#125;&lt;/div&gt; ); &#125;&#125; æ€»ç»“ï¼š æŸ¥çœ‹å½“å‰ DOM çš„æŸäº›å±žæ€§ï¼Œå¹¶å°†è¯¥å€¼ä¼ é€’ç»™componentDidUpdatã€‚ componentDidUpdate æ‰€æœ‰çš„æ”¹å˜éƒ½å·²ç»æäº¤ç»™ DOMã€‚ componentDidUpdate åŒ…å«ä¸‰ä¸ªå‚æ•°ï¼Œä¹‹å‰çš„ propsã€stateï¼Œä»¥åŠ getSnapshotBeforeUpdate çš„è¿”å›žå€¼ï¼Œå…·ä½“å¦‚ä¸Šè¿°ä¾‹å­ã€‚ æ€»ç»“ï¼š å¯¹å·²ç»æ”¹å˜çš„ Dom ä½œå‡ºç›¸å…³å“åº”ã€‚ UnmountingcomponentWillUnmount ç»„ä»¶å¿«è¦ç»“æŸäº†ã€‚ åœ¨ç»„ä»¶æ³¨é”€ä¹‹å‰ï¼Œå®ƒä¼šè¯¢é—®æ‚¨æ˜¯å¦æœ‰ä»»ä½•æœ€åŽä¸€åˆ»çš„è¯·æ±‚ã€‚ æ‚¨å¯ä»¥åœ¨æ­¤å¤„å–æ¶ˆä»»ä½•ä¼ å‡ºç½‘ç»œè¯·æ±‚ï¼Œæˆ–åˆ é™¤ä¸Žè¯¥ç»„ä»¶å…³è”çš„æ‰€æœ‰äº‹ä»¶ä¾¦å¬å™¨ã€‚ åŸºæœ¬ä¸Šï¼Œæ¸…ç†ä»»ä½•äº‹æƒ…éƒ½åªæ¶‰åŠæœ‰é—®é¢˜çš„ç»„ä»¶ - å½“å®ƒæ¶ˆå¤±æ—¶ï¼Œå®ƒåº”è¯¥å®Œå…¨æ¶ˆå¤±ã€‚ æ€»ç»“ï¼š æ¸…é™¤äº‹ä»¶ç›‘å¬ã€å®šæ—¶å™¨ç­‰ï¼Œé˜²æ­¢å†…å­˜æ³„æ¼ã€‚ ErrorsgetDerivedStateFromError å‘ç”Ÿäº†ä¸€äº›å¼‚å¸¸ã€‚ å®ƒèƒ½å¤Ÿæ•æ‰åœ¨ä»–ä»¬çš„å­ç»„ä»¶æ ‘ä¸­ä»»æ„åœ°æ–¹çš„ JavaScript é”™è¯¯ï¼Œè®°å½•è¿™äº›é”™è¯¯ã€‚å½“æˆ‘ä»¬è¦å±•ç¤ºä¸€ä¸ª error é¡µé¢æ—¶ï¼Œå¯ä»¥åˆ©ç”¨å®ƒæ¥å®Œæˆã€‚ 123static getDerivedStateFromError(error) &#123; return &#123; hasError: true &#125;;&#125; æ³¨æ„ï¼š æ‚¨å¿…é¡»è¿”å›žæ›´æ–°çš„çŠ¶æ€å¯¹è±¡ã€‚ ä¸è¦å°†æ­¤æ–¹æ³•ç”¨äºŽä»»ä½•å‰¯ä½œç”¨ã€‚ è€Œæ˜¯ä½¿ç”¨ä¸‹é¢çš„ componentDidCatchã€‚ æ€»ç»“ï¼š ä¾æ®é”™è¯¯ä¿¡æ¯æ¥ä¿®æ”¹ç»„ä»¶çš„ stateï¼ŒåŒæ—¶å±•ç¤ºå‡º error é¡µé¢ã€‚ componentDidCatch ä¸Žä¸Šé¢éžå¸¸ç›¸ä¼¼ï¼Œå› ä¸ºå®ƒåœ¨å­ç»„ä»¶ä¸­å‘ç”Ÿé”™è¯¯æ—¶è¢«è§¦å‘ã€‚ ä¸Ž getDerivedStateFromError åŒºåˆ«åœ¨äºŽä¸æ˜¯ä¸ºäº†å“åº”é”™è¯¯è€Œæ›´æ–°çŠ¶æ€ï¼Œå¯ä»¥æ‰§è¡Œä»»ä½•å‰¯ä½œç”¨ï¼Œä¾‹å¦‚è®°å½•é”™è¯¯ã€‚ 123componentDidCatch(error, info) &#123; sendErrorLog(error, info);&#125; æ³¨æ„ï¼š componentDidCatch ä»…ä¼šæ•èŽ·æ¸²æŸ“/ç”Ÿå‘½å‘¨æœŸæ–¹æ³•ä¸­çš„é”™è¯¯ã€‚ å¦‚æžœåœ¨å•å‡»å¤„ç†ç¨‹åºä¸­å¼•å‘é”™è¯¯ï¼Œåˆ™ä¸ä¼šæ•èŽ·å®ƒã€‚ é€šå¸¸åªåœ¨ç‰¹æ®Šçš„åœ°æ–¹ä½¿ç”¨é”™è¯¯è¾¹ç•Œç»„ä»¶çš„ componentDidCatchã€‚ è¿™äº›ç»„ä»¶åŒ…è£…å­æ ‘çš„å”¯ä¸€ç›®çš„æ˜¯æ•èŽ·å’Œè®°å½•é”™è¯¯ã€‚ 123456789101112131415class ErrorBoundary extends Component &#123; state = &#123; errorMessage: null &#125;; static getDerivedStateFromError(error) &#123; return &#123; errorMessage: error.message &#125;; &#125; componentDidCatch(error, info) &#123; console.log(error, info); &#125; render() &#123; if (this.state.errorMessage) &#123; return &lt;h1&gt;Oops! &#123;this.state.errorMessage&#125;&lt;/h1&gt;; &#125; return this.props.children; &#125;&#125; æ€»ç»“ï¼š æ•èŽ·ã€æ‰“å°å‡ºé”™è¯¯ä¿¡æ¯ã€‚ æ€»ç»“ä»¥ä¸Šæ˜¯React v16çš„ç”Ÿå‘½å‘¨æœŸé’©å­æ‰€é€‚ç”¨çš„åœºæ™¯å’Œå…·ä½“ä½¿ç”¨æ–¹æ³•ã€‚]]></content>
      <tags>
        <tag>react</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Lodash æ˜¯å¦‚ä½•åšç±»åž‹æ£€æµ‹çš„]]></title>
    <url>%2F2019%2F07%2F21%2Flodash-type-detection%2F</url>
    <content type="text"><![CDATA[JS çš„åŸºæœ¬æ•°æ®ç±»åž‹æœ‰ Numberï¼ŒStringï¼ŒBooleanï¼ŒSymbolï¼ŒNullï¼ŒUndefinedï¼Œå…­ç§æ•°æ®ç±»åž‹ã€‚ä¸€ç§å¼•ç”¨ç±»åž‹ objectã€‚ åŸºæœ¬æ•°æ®ç±»åž‹Numberæ•°å€¼ï¼Œæ ¹æ® ECMAScript æ ‡å‡†ï¼ŒJavaScript ä¸­åªæœ‰ä¸€ç§æ•°å­—ç±»åž‹ï¼šåŸºäºŽ IEEE 754 æ ‡å‡†çš„åŒç²¾åº¦ 64 ä½äºŒè¿›åˆ¶æ ¼å¼çš„å€¼ï¼ˆ-(263 -1) åˆ° 263 -1ï¼‰ã€‚å®ƒå¹¶æ²¡æœ‰ä¸ºæ•´æ•°ç»™å‡ºä¸€ç§ç‰¹å®šçš„ç±»åž‹ã€‚ é™¤äº†èƒ½å¤Ÿè¡¨ç¤ºæµ®ç‚¹æ•°å¤–ï¼Œè¿˜æœ‰ä¸€äº›å¸¦ç¬¦å·çš„å€¼ï¼š+Infinityï¼Œ-Infinity å’Œ NaN (éžæ•°å€¼ï¼ŒNot-a-Number)ã€‚ å¯¹åº” lodash ä¸­çš„æ£€æµ‹å‡½æ•°æœ‰ isNumber æ£€æŸ¥ value æ˜¯å¦æ˜¯åŽŸå§‹ Number æ•°å€¼åž‹ æˆ–è€… å¯¹è±¡ï¼› isInteger æ£€æŸ¥ value æ˜¯å¦ä¸ºä¸€ä¸ªæ•´æ•°ï¼› isNaN æ£€æµ‹ value æ˜¯å¦ä¸º NaNï¼› isFinite æ£€æµ‹ value æ˜¯å¦æ˜¯åŽŸå§‹æœ‰é™æ•°å€¼ã€‚ isNumber1234function isNumber(value) &#123; return typeof value == 'number' || (isObjectLike(value) &amp;&amp; getTag(value) == '[object Number]')&#125; typeof æ“ä½œç¬¦å¯ä»¥è¿”å›žä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œè¡¨ç¤ºæœªç»è®¡ç®—çš„æ“ä½œæ•°çš„ç±»åž‹ã€‚å¯¹äºŽ Numberã€Stringã€Booleanã€Undefinedã€String å¯ä»¥å¾ˆæ˜Žç¡®çš„å¾—åˆ°å®ƒçš„ç±»åž‹ã€‚ é‚£ä¹ˆ lodash ä¸ºä»€ä¹ˆè¿˜è¦æ·»åŠ  (isObjectLike(value) &amp;&amp; getTag(value) == &#39;[object Number]&#39;)ï¼Ÿ åŽŸå› åœ¨äºŽï¼ŒJS ä¸­ä¹Ÿå…è®¸æˆ‘ä»¬ä»¥å¦‚ä¸‹å½¢å¼åˆ›å»ºä¸€ä¸ªæ•°å€¼ 123const value = new Number(1)console.log(value) // log 1console.log(typeof value) // log "object" è¿™æ—¶ï¼Œå•å•åªæ˜¯ä½¿ç”¨ typeof æ“ä½œç¬¦å°±æ²¡æ³•åˆ¤æ–­ value çš„ç±»åž‹æ˜¯å¦ä¸ºæ•°å€¼ã€‚æ‰€ä»¥è¦ç»“åˆä»¥ä¸‹ä¸¤ä¸ªå‡½æ•°æ¥åˆ¤æ–­ï¼Œvalue æ˜¯å¦ä¸º object ç„¶åŽå†é€šè¿‡è¿‡ toString() æ¥èŽ·å–æ¯ä¸ªå¯¹è±¡çš„ç±»åž‹ã€‚ 12345678910function getTag(value) &#123; if (value == null) &#123; return value === undefined ? '[object Undefined]' : '[object Null]' &#125; return Object.prototype.toString.call(value) &#125;function isObjectLike(value) &#123; return typeof value == 'object' &amp;&amp; value !== null&#125; Object.prototype.toString.call æ¯ä¸ªå¯¹è±¡éƒ½æœ‰ä¸€ä¸ªtoString()æ–¹æ³•ï¼Œå½“è¯¥å¯¹è±¡è¢«è¡¨ç¤ºä¸ºä¸€ä¸ªæ–‡æœ¬å€¼æ—¶ï¼Œæˆ–è€…ä¸€ä¸ªå¯¹è±¡ä»¥é¢„æœŸçš„å­—ç¬¦ä¸²æ–¹å¼å¼•ç”¨æ—¶è‡ªåŠ¨è°ƒç”¨ã€‚ isInteger12345function isInteger(value) &#123; return typeof value == 'number' &amp;&amp; value == toInteger(value);&#125; æ£€æŸ¥ value æ˜¯å¦ä¸ºä¸€ä¸ªæ•´æ•°ï¼Œåˆ¤æ–­æ˜¯å¦ value çš„ç±»åž‹æ˜¯å¦ä¸ºæ•°å€¼ï¼Œå¹¶ä¸”æ˜¯å¦ä¸Ž Int åž‹ç›¸åŒã€‚å…¶å–æ•´è¿‡ç¨‹å¦‚ä¸‹ 1234567function toInteger(value) &#123; var result = toFinite(value), remainder = result % 1; return result === result ? (remainder ? result - remainder : result) : 0;&#125; isNaNæ£€æŸ¥ value æ˜¯å¦æ˜¯ NaNã€‚ 123function isNaN(value) &#123; return isNumber(value) &amp;&amp; value != +value;&#125; ä¸Ž ES 2015 çš„ isNaN ä¸åŒçš„æ˜¯ï¼Œå¯¹äºŽ undefinedï¼Œ{}ï¼ŒåŽŸç”Ÿçš„ç»“æžœæ˜¯ trueï¼Œè€Œ lodash ä¸º falseã€‚è¿™æ˜¯å› ä¸ºå¦‚æžœisNaNå‡½æ•°çš„å‚æ•°ä¸æ˜¯Numberç±»åž‹ï¼Œ isNaNå‡½æ•°ä¼šé¦–å…ˆå°è¯•å°†è¿™ä¸ªå‚æ•°è½¬æ¢ä¸ºæ•°å€¼ï¼Œç„¶åŽæ‰ä¼šå¯¹è½¬æ¢åŽçš„ç»“æžœæ˜¯å¦æ˜¯NaNè¿›è¡Œåˆ¤æ–­ã€‚ 12345// js native isNaNvar isNaN = function(value) &#123; var n = Number(value); return n !== n;&#125;; ä½†æ˜¯æ— è®ºæ˜¯ ES 2015 è¿˜æ˜¯ lodashï¼Œå®ƒä»¬æœ¬è´¨ä¸Šéƒ½æ˜¯åˆ©ç”¨ x != x æ¥åˆ¤æ–­ NaNã€‚ isFiniteæ£€æŸ¥ value æ˜¯å¦æ˜¯åŽŸå§‹æœ‰é™æ•°å€¼ã€‚ 1234function isFinite(value) &#123; return typeof value == 'number' &amp;&amp; nativeIsFinite(value);&#125; åˆ©ç”¨åŽŸç”Ÿçš„ isFinite ç»“åˆ typeof åˆ¤æ–­æ•°å­—æ˜¯å¦ä¸ºæœ‰é™å€¼ã€‚ StringString ç±»åž‹ç”¨äºŽè¡¨ç¤ºç”±é›¶æˆ–å¤šä¸ª16 ä½Unicode å­—ç¬¦ç»„æˆçš„å­—ç¬¦åºåˆ—ï¼Œå³å­—ç¬¦ä¸²ã€‚ç”¨äºŽä¿å­˜å¯ä»¥ä»¥æ–‡æœ¬å½¢å¼è¡¨ç¤ºçš„æ•°æ®éžå¸¸æœ‰ç”¨ã€‚ å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œä¸å•å•è¦æ³¨æ„åŸºæœ¬å­—ç¬¦ä¸²ï¼Œè¿˜éœ€è¦æ³¨æ„å­—ç¬¦ä¸²å¯¹è±¡ï¼Œå­—ç¬¦ä¸²å­—é¢é‡ (é€šè¿‡å•å¼•å·æˆ–åŒå¼•å·å®šä¹‰) å’Œ ç›´æŽ¥è°ƒç”¨ String æ–¹æ³•(æ²¡æœ‰é€šè¿‡ new ç”Ÿæˆå­—ç¬¦ä¸²å¯¹è±¡å®žä¾‹)çš„å­—ç¬¦ä¸²éƒ½æ˜¯åŸºæœ¬å­—ç¬¦ä¸²ã€‚ JavaScriptä¼šè‡ªåŠ¨å°†åŸºæœ¬å­—ç¬¦ä¸²è½¬æ¢ä¸ºå­—ç¬¦ä¸²å¯¹è±¡ï¼Œåªæœ‰å°†åŸºæœ¬å­—ç¬¦ä¸²è½¬åŒ–ä¸ºå­—ç¬¦ä¸²å¯¹è±¡ä¹‹åŽæ‰å¯ä»¥ä½¿ç”¨å­—ç¬¦ä¸²å¯¹è±¡çš„æ–¹æ³•ã€‚ ä¸Žä¹‹å‰çš„ number ç±»ä¼¼ï¼Œåˆ©ç”¨æž„é€ å‡½æ•° String åˆ›å»ºçš„å­—ç¬¦ä¸²æ˜¯ä¸€ä¸ª object 12345const s_prim = "foo";const s_obj = new String(s_prim);console.log(typeof s_prim); // Logs "string"console.log(typeof s_obj); // Logs "object" æ‰€ä»¥æ£€æµ‹å­—ç¬¦ä¸²ï¼Œé™¤äº†åŸºæœ¬å­—ç¬¦ä¸²ä»¥å¤–è¿˜è¦æ³¨æ„å­—ç¬¦ä¸²å¯¹è±¡ã€‚ 123456789function isString(value) &#123; const type = typeof value return type == 'string' || (type == 'object' &amp;&amp; value != null &amp;&amp; !Array.isArray(value) &amp;&amp; getTag(value) == '[object String]')&#125; å¯ä»¥åˆ©ç”¨ typeof æ£€æµ‹åŸºæœ¬å­—ç¬¦ä¸²ï¼Œå¯¹äºŽæ¨¡æ¿å­—ç¬¦ä¸²é‡‡ç”¨äº†ä¹‹å‰ä»‹ç»çš„æ–¹æ¡ˆ getTag æ¥èŽ·å– value çš„ç±»åž‹ã€‚ BooleanBoolean ç±»åž‹æ˜¯ECMAScript ä¸­ä½¿ç”¨å¾—æœ€å¤šçš„ä¸€ç§ç±»åž‹ï¼Œè¯¥ç±»åž‹åªæœ‰ä¸¤ä¸ªå­—é¢å€¼ï¼štrue å’Œ falseã€‚åŒæ ·ä¹Ÿéœ€è¦åŒºåˆ†åŸºæœ¬çš„ Boolean ç±»åž‹ä»¥åŠ Boolean å¯¹è±¡ã€‚ 123456function isBoolean(value) &#123; return value === true || value === false || (isObjectLike(value) &amp;&amp; getTag(value) == '[object Boolean]')&#125; å¤§éƒ¨åˆ†åœ¨ä¹‹å‰éƒ½å·²ç»æ¶‰åŠåˆ°äº†ï¼Œè¿™é‡Œå‡ºçŽ°äº† isObjectLikeï¼Œé‚£ä¹ˆå®ƒæ˜¯åšä»€ä¹ˆçš„ã€‚ 123function isObjectLike(value) &#123; return typeof value == 'object' &amp;&amp; value !== null&#125; åŽŸæ¥åªæ˜¯æ£€æµ‹æ˜¯å¦æ˜¯ä¸€ä¸ªéž null çš„å¯¹è±¡ã€‚ SymbolES6 å¼•å…¥äº†ä¸€ç§æ–°çš„åŽŸå§‹æ•°æ®ç±»åž‹Symbolï¼Œè¡¨ç¤ºç‹¬ä¸€æ— äºŒçš„å€¼ã€‚Symbol å€¼é€šè¿‡Symbolå‡½æ•°ç”Ÿæˆã€‚ 123456function isSymbol(value) &#123; const type = typeof value return type == 'symbol' || (isObjectLike(value) &amp;&amp; getTag(value) == '[object Symbol]')&#125; ä¼šå‘çŽ° (isObjectLike(value) &amp;&amp; getTag(value) == &#39;[object Symbol]&#39;)ï¼Œä¹Ÿå¯¹ Symbol å¯¹è±¡è¿›è¡Œæ£€æµ‹ï¼Œä½†æ˜¯å¦‚æžœç›´æŽ¥ new Symbol ä¼š log å‡º TypeErrorã€‚ é‚£ä¹ˆ lodash ä¸ºä»€ä¹ˆè¦å¯¹å…¶è¿›è¡Œæ£€æµ‹ï¼ŒåŽŸæ¥æ˜¯åˆ›å»ºä¸€ä¸ªæ˜¾å¼åŒ…è£…å™¨å¯¹è±¡ä»Ž ECMAScript 6 å¼€å§‹ä¸å†è¢«æ”¯æŒï¼ŒçŽ°åœ¨å¯ä»¥åˆ©ç”¨å¦‚ä¸‹ä»£ç æ¥æ¨¡æ‹Ÿï¼Œè™½ç„¶æ²¡ä»€ä¹ˆç”¨ã€‚ 1234const sym = Symbol("foo");typeof sym; // "symbol"const symObj = Object(sym);typeof symObj; // "object" UndefinedUndefined ç±»åž‹åªæœ‰ä¸€ä¸ªå€¼ï¼Œå³ç‰¹æ®Šçš„ undefinedã€‚åœ¨ä½¿ç”¨ let æˆ– var å£°æ˜Žå˜é‡ä½†æœªå¯¹å…¶åŠ ä»¥åˆå§‹åŒ–æ—¶ï¼Œè¿™ä¸ªå˜é‡çš„å€¼å°±æ˜¯ undefinedã€‚ 123function isUndefined(value) &#123; return value === undefined;&#125; NullNull ç±»åž‹æ˜¯åªæœ‰ä¸€ä¸ªå€¼çš„æ•°æ®ç±»åž‹ï¼Œè¿™ä¸ªç‰¹æ®Šçš„å€¼æ˜¯ null ã€‚ä¸Ž undefined ä¸åŒçš„æ˜¯ï¼Œå®ƒæ˜¯ä¸€ä¸ªå­—é¢é‡ï¼Œè€Œ undefined æ˜¯å…¨å±€å¯¹è±¡çš„ä¸€ä¸ªå±žæ€§ã€‚ ä»Žé€»è¾‘è§’åº¦æ¥çœ‹ï¼Œnull å€¼è¡¨ç¤ºä¸€ä¸ªç©ºå¯¹è±¡æŒ‡é’ˆï¼Œnull æ˜¯è¡¨ç¤ºç¼ºå°‘çš„æ ‡è¯†ï¼ŒæŒ‡ç¤ºå˜é‡æœªæŒ‡å‘ä»»ä½•å¯¹è±¡ã€‚è€Œè¿™ä¹Ÿæ­£æ˜¯ä½¿ç”¨typeof æ“ä½œç¬¦æ£€æµ‹null å€¼æ—¶ä¼šè¿”å›žâ€objectâ€çš„åŽŸå› ã€‚ å¯¹å…¶çš„åˆ¤æ–­ä¹Ÿéžå¸¸çš„ç®€å•ï¼Œåªéœ€è¦ 123function isNull(value) &#123; return value === null&#125; å½“ç„¶ä½ ä¹Ÿå¯ä»¥ä½¿ç”¨ 12console.log(Object.prototype.toString.call(null))// [object Null] ä»¥ä¸Šæ˜¯åŸºæœ¬æ•°æ®ç±»åž‹çš„åˆ¤æ–­ï¼Œæ€»ç»“ä¸€ä¸‹ï¼Œä¸»è¦æ˜¯åˆ©ç”¨ typeOf ä»¥åŠ Object.prototype.toString ï¼Œè¿˜æœ‰ä¸€äº›ç‰¹æ®Šå€¼çš„ç‰¹æ€§ã€‚ä¸‹é¢å¼€å§‹åˆ†æžå¼•ç”¨ç±»åž‹ Object å¼•ç”¨ç±»åž‹å¼•ç”¨ç±»åž‹çš„å€¼ï¼ˆå¯¹è±¡ï¼‰æ˜¯å¼•ç”¨ç±»åž‹çš„ä¸€ä¸ªå®žä¾‹ã€‚åœ¨ECMAScript ä¸­ï¼Œå¼•ç”¨ç±»åž‹æ˜¯ä¸€ç§æ•°æ®ç»“æž„ï¼Œç”¨äºŽå°†æ•°æ®å’ŒåŠŸèƒ½ç»„ç»‡åœ¨ä¸€èµ·ã€‚å…·ä½“çš„æœ‰ Object ã€Arrayã€Dateã€Errorã€RegExpã€Functionï¼Œè¿˜æœ‰ES2015 å¼•å…¥ Setã€Mapã€WeakSetã€WeakMapã€‚ ObjectECMAScript ä¸­çš„å¯¹è±¡å…¶å®žå°±æ˜¯ä¸€ç»„æ•°æ®å’ŒåŠŸèƒ½çš„é›†åˆã€‚å®ƒæœ‰ä¸€ä¸ªå¾ˆé‡è¦çš„ç”¨é€”ï¼Œå°±æ˜¯åœ¨ JavaScript ä¸­çš„æ‰€æœ‰å¯¹è±¡éƒ½æ¥è‡ª Objectï¼›æ‰€æœ‰å¯¹è±¡ä»ŽObject.prototypeç»§æ‰¿æ–¹æ³•å’Œå±žæ€§ï¼Œå°½ç®¡å®ƒä»¬å¯èƒ½è¢«è¦†ç›–ã€‚å³åœ¨ECMAScript ä¸­ï¼ŒObject ç±»åž‹æ˜¯æ‰€æœ‰å®ƒçš„å®žä¾‹çš„åŸºç¡€ã€‚ æ‰€ä»¥ Lodash åŽ»åˆ¤æ–­ value æ˜¯å¦ä¸º Object æ—¶ï¼Œåªä½¿ç”¨äº† typeOf æ“ä½œå³å¯ã€‚ 12345function isObject(value) &#123; const type = typeof value return value != null &amp;&amp; (type == 'object' || type == 'function')&#125; FunctionFunction æž„é€ å‡½æ•° åˆ›å»ºä¸€ä¸ªæ–°çš„Functionå¯¹è±¡ã€‚ åœ¨ JavaScript ä¸­, æ¯ä¸ªå‡½æ•°å®žé™…ä¸Šéƒ½æ˜¯ä¸€ä¸ªFunctionå¯¹è±¡ã€‚ 1234567891011function isFunction(value) &#123; if (!isObject(value)) &#123; return false &#125; const tag = getTag(value) return tag == '[object Function]' || tag == '[object AsyncFunction]' || tag == '[object GeneratorFunction]' || tag == '[object Proxy]'&#125; æœ‰ä¸ªé—®é¢˜ï¼ŒtypeOf å¯ä»¥æ£€æµ‹ Functionå¯¹è±¡çš„ç±»åž‹ä¸º Functionï¼Œ é‚£ä¸ºä»€ä¹ˆè¿˜éœ€è¦ Object.prototype.toString å‘¢ï¼Ÿ // in Safari 9 which returns â€˜objectâ€™ for typed arrays and other constructors. ArrayArray åœ¨ ECMAScript ä¸­ä»£è¡¨æ•°ç»„ï¼Œå®ƒçš„æ¯ä¸€é¡¹å¯ä»¥ä¿å­˜ä»»ä½•ç±»åž‹çš„æ•°æ®ã€‚ å¯¹å®ƒçš„å¸¸è§„æ£€æµ‹å°±æ˜¯ Array.isArrayï¼ŒLodash ä¹Ÿæ˜¯ä½¿ç”¨è¿™ä¸ª APIï¼Œå¦‚æžœéœ€è¦ Polyfill æ–¹æ¡ˆçš„è¯ï¼Œå¯ä»¥ä½¿ç”¨ 1234// plan 1Object.prototype.toString.call(value) === '[object Array]'// plan 2value.constructor === Array ä¹‹å‰è¿˜æœ‰ value instanceof Array ä¼šä»€ä¹ˆé—®é¢˜ä¹ˆï¼Ÿ åœ¨å­˜åœ¨ä¸åŒå…¨å±€å˜é‡çš„çŽ¯å¢ƒï¼Œé€šè¿‡è¯­ä¹‰ instanceof æ£€æµ‹æ•°ç»„çš„æ—¶å€™ï¼Œvalue instanceof Arrayåªæœ‰å½“ value æ˜¯ç”±è¯¥é¡µé¢çš„åŽŸå§‹ Array æž„é€ å‡½æ•°åˆ›å»ºçš„æ•°ç»„æ—¶æ‰èƒ½æ­£å¸¸å·¥ä½œã€‚ å…·ä½“è¯·è§ï¼Œhttp://web.mit.edu/jwalden/www/isArray.htmlã€‚ DateECMAScript ä¸­çš„ Date ç±»åž‹æ˜¯åœ¨æ—©æœŸJava ä¸­çš„java.util.Date ç±»åŸºç¡€ä¸Šæž„å»ºçš„ã€‚ 12345const nodeIsDate = nodeTypes &amp;&amp; nodeTypes.isDateconst isDate = nodeIsDate ? (value) =&gt; nodeIsDate(value) : (value) =&gt; isObjectLike(value) &amp;&amp; getTag(value) == '[object Date]' Lodash åˆ†ä¸ºä¸¤ä¸ªçŽ¯å¢ƒæ¥å¤„ç†è¿™ä¸ªé—®é¢˜ï¼Œå¦‚æžœæ˜¯ Node å°±åˆ©ç”¨ util.types.isDate(value) æ¥æ£€æµ‹ï¼Œå¦‚æžœæ˜¯åœ¨æ¸¸è§ˆå™¨ï¼Œå°±è¿˜æ˜¯é€šè¿‡ Object.prototype.toString æ¥åˆ¤æ–­ã€‚ SetES2015 æä¾›äº†æ–°çš„æ•°æ®ç»“æž„ Setã€‚å®ƒç±»ä¼¼äºŽæ•°ç»„ï¼Œä½†æ˜¯æˆå‘˜çš„å€¼éƒ½æ˜¯å”¯ä¸€çš„ï¼Œæ²¡æœ‰é‡å¤çš„å€¼ã€‚ 123const isSet = nodeIsSet ? (value) =&gt; nodeIsSet(value) : (value) =&gt; isObjectLike(value) &amp;&amp; getTag(value) == '[object Set]' åŒæ ·çš„è¿˜æœ‰ Map 123const isMap = nodeIsMap ? (value) =&gt; nodeIsMap(value) : (value) =&gt; isObjectLike(value) &amp;&amp; getTag(value) == '[object Map]' WeakSetWeakSet ç»“æž„ä¸Ž Set ç±»ä¼¼ï¼Œä¹Ÿæ˜¯ä¸é‡å¤çš„å€¼çš„é›†åˆã€‚ä½†æ˜¯ï¼Œå®ƒä¸Ž Set æœ‰ä¸¤ä¸ªåŒºåˆ«ã€‚ 123function isWeakSet(value) &#123; return isObjectLike(value) &amp;&amp; getTag(value) == '[object WeakSet]'&#125; ä¹Ÿæ˜¯åˆ©ç”¨ Object.prototype.toString ï¼ŒåŒæ ·è¿˜æœ‰ WeakMap 123function isWeakMap(value) &#123; return isObjectLike(value) &amp;&amp; getTag(value) == '[object WeakMap]'&#125; Errorå½“è¿è¡Œæ—¶é”™è¯¯äº§ç”Ÿæ—¶ï¼ŒErrorçš„å®žä¾‹å¯¹è±¡ä¼šè¢«æŠ›å‡ºã€‚ 12345678910function isError(value) &#123; if (!isObjectLike(value)) &#123; return false &#125; const tag = getTag(value) return tag == '[object Error]' || tag == '[object DOMException]' || (typeof value.message == 'string' &amp;&amp; typeof value.name == 'string' &amp;&amp; !isPlainObject(value))&#125; æœ‰ä¹‹å‰ä¸€è‡´çš„ Object.prototype.toString ä¾ç„¶å¯ä»¥ç”¨æ¥åˆ¤æ–­å¯¹è±¡æ˜¯å¦æ˜¯ä¸€ä¸ª Errorï¼Œé™¤æ­¤ä¹‹å¤–ï¼Œå¦‚æžœå¯¹è±¡æ»¡è¶³ä»¥ä¸‹æ¡ä»¶ï¼Œä¹Ÿå¯ä»¥è¢«è§†ä¸ºä¸€ä¸ª Error å…·å¤‡ messageã€name å±žæ€§ï¼Œä¸”å€¼ä¸º stringï¼› æ˜¯æ™®é€šå¯¹è±¡ã€‚ ä¹Ÿå°±æ˜¯è¯´è¯¥å¯¹è±¡ç”± Object æž„é€ å‡½æ•°åˆ›å»ºï¼Œæˆ–è€… [[Prototype]] ä¸º null ã€‚ é‚£ä¹ˆå¦‚ä½•æ£€æµ‹æ™®é€šå¯¹è±¡å‘¢? 12345678910111213function isPlainObject(value) &#123; if (!isObjectLike(value) || getTag(value) != '[object Object]') &#123; return false &#125; if (Object.getPrototypeOf(value) === null) &#123; return true &#125; let proto = value while (Object.getPrototypeOf(proto) !== null) &#123; proto = Object.getPrototypeOf(proto) &#125; return Object.getPrototypeOf(value) === proto&#125; ä¸»è¦æ˜¯åˆ©ç”¨ Object.getPrototypeOf() æ–¹æ³•è¿”å›žæŒ‡å®šå¯¹è±¡çš„åŽŸåž‹ï¼ˆå†…éƒ¨[[Prototype]]å±žæ€§çš„å€¼ï¼‰ï¼ŒåŒæ—¶å’Œ value æœ¬èº«çš„ [[Prototype]] åšåˆ¤æ–­ã€‚]]></content>
      <categories>
        <category>web</category>
      </categories>
      <tags>
        <tag>javascript</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Vue åŠ¨æ€ç»„ä»¶ & å¼‚æ­¥ç»„ä»¶åŽŸç†]]></title>
    <url>%2F2019%2F07%2F19%2Fvue-dynamic-components%2F</url>
    <content type="text"><![CDATA[åŠ¨æ€ç»„ä»¶ &amp; å¼‚æ­¥ç»„ä»¶çš„å­˜åœ¨ï¼Œä½¿å¾—æˆ‘ä»¬æ›´æ–¹ä¾¿åœ°æŽ§åˆ¶é¦–å±ä»£ç çš„ä½“ç§¯ï¼ŒåŠ å¿«åŠ è½½é€Ÿåº¦ã€‚ æŠ›å¼€å…·ä½“ç»†èŠ‚ä¸è°ˆï¼Œä¸€ä¸ªæ™®é€š Vue ç»„ä»¶ä»Žåˆ›å»ºåˆ°å±•çŽ°åœ¨é¡µé¢é‡Œï¼Œä¸»è¦ç»åŽ†äº†ä»¥ä¸‹æµç¨‹ï¼š 123456789// ç»„ä»¶ Object&#123; template: '&lt;div&gt;I am async!&lt;/div&gt;'&#125;// ç»è¿‡ compileToFunctions å¾—åˆ°å¯¹åº”çš„ render function with(this) &#123; return _c('div', [_v("I am async!")])&#125;// åœ¨ç»è¿‡ render å¾—åˆ° Vnode å† update æˆä¸ºçœŸå®žDOM åŠ¨æ€ç»„ä»¶&amp;å¼‚æ­¥ç»„ä»¶ä¸Žä¹‹æœ‰ä»€ä¹ˆåŒºåˆ«å‘¢ï¼Ÿ ä¸»è¦åŒºåˆ«åœ¨äºŽ render ä¸­ createComponent è¿™ä¸€æ­¥ï¼Œä¸¾ä¾‹ã€‚ 1234// ç»„ä»¶Vue.component('example', &#123; template: '&lt;div&gt;I am async!&lt;/div&gt;'&#125;) æ™®é€šç»„ä»¶åœ¨ createComponent æ—¶ï¼Œä¼šä¾æ®å¼€å‘è€…è‡ªå®šä¹‰çš„ optionsï¼Œåˆ©ç”¨ Vue.extend ç”Ÿæˆå¯¹åº”çš„æž„é€ å‡½æ•°ï¼Œä»Žè€Œå¾—åˆ°å¯¹åº”çš„ Vnode ã€‚è€Œä¸€ä¸ªå¼‚æ­¥ç»„ä»¶ 12345678910// å¼‚æ­¥ç»„ä»¶Vue.component('async-example', function (resolve, reject) &#123; // åˆ©ç”¨ setTimeout æ¨¡æ‹Ÿè¯·æ±‚ setTimeout(function () &#123; // å‘ `resolve` å›žè°ƒä¼ é€’ç»„ä»¶å®šä¹‰ resolve(&#123; template: '&lt;div&gt;I am async!&lt;/div&gt;' &#125;) &#125;, 1000)&#125;) åˆ™æ˜¯è¦ç»è¿‡ä¸€ç³»åˆ—å¤„ç†ï¼Œå…·ä½“è¿‡ç¨‹å¦‚ä¸‹ åœ¨æºç çš„ create-componentã€‚ 123456789101112131415161718// async componentlet asyncFactoryif (isUndef(Ctor.cid)) &#123; asyncFactory = Ctor Ctor = resolveAsyncComponent(asyncFactory, baseCtor, context) if (Ctor === undefined) &#123; // return a placeholder node for async component, which is rendered // as a comment node but preserves all the raw information for the node. // the information will be used for async server-rendering and hydration. return createAsyncPlaceholder( asyncFactory, data, context, children, tag ) &#125;&#125; é¦–å…ˆ Ctor å°±ä¸Žä¹‹å‰ä¸åŒï¼Œè¿™é‡Œä¸ºä¸€ä¸ª function 123456789function (resolve, reject) &#123; // åˆ©ç”¨ setTimeout æ¨¡æ‹Ÿè¯·æ±‚ setTimeout(function () &#123; // å‘ `resolve` å›žè°ƒä¼ é€’ç»„ä»¶å®šä¹‰ resolve(&#123; template: '&lt;div&gt;I am async!&lt;/div&gt;' &#125;) &#125;, 1000)&#125; ä¹‹åŽè°ƒç”¨ resolveAsyncComponent(asyncFactory, baseCtor, context) resolveAsyncComponent åœ¨æºç çš„ resolveAsyncComponentã€‚ resolveAsyncComponent çš„ä¸»è¦åŠŸèƒ½æ˜¯å®šä¹‰ Ctor æ‰€éœ€è¦çš„ resolve ã€reject å‡½æ•° 12// factory ä¸º Ctorfactory(resolve, reject) ä»¥ resolve å‡½æ•°ä¸ºä¾‹ 12345678const resolve = once((res: Object | Class&lt;Component&gt;) =&gt; &#123; // ç¼“å­˜ resolved factory.resolved = ensureCtor(res, baseCtor) // å¼ºåˆ¶æ¸²æŸ“ if (!sync) &#123; forceRender(true) &#125;&#125;) once å­—é¢ç†è§£ï¼Œå°±æ˜¯åªè°ƒç”¨ä¸€æ¬¡ã€‚å½“ Ctor ä¸­ setTimeout ç»“æŸæ—¶è°ƒç”¨ã€‚ ensureCtor å°±æ˜¯ Vue.extend çš„å°è£…ä»¥é€‚åº”ä¸åŒåœºæ™¯ï¼Œæ‰€ä»¥ resolve å‡½æ•°çš„ä¸»è¦åŠŸèƒ½å°±æ˜¯åœ¨å¼‚æ­¥å®Œæˆæ—¶ï¼Œå°†å¾—åˆ°çš„ Ctor è½¬åŒ–ä¸ºæž„é€ å‡½æ•°ï¼Œç¼“å­˜åœ¨ factory.resolved ä¸­ã€‚ ä¹‹åŽåˆ©ç”¨ forceRender(true) å¼ºåˆ¶é‡æ–° renderï¼Œç”±äºŽä¹‹å‰ç¼“å­˜äº† factory.resolvedï¼ŒresolveAsyncComponent å‡½æ•°å°±ç›´æŽ¥è¿”å›žäº†ç»„ä»¶çš„æž„é€ å‡½æ•°ã€‚ 123if (isDef(factory.resolved)) &#123; return factory.resolved&#125; ä¹‹åŽå°±ä¸Žæ™®é€šç»„ä»¶ä¸€è‡´äº†ã€‚]]></content>
      <categories>
        <category>web</category>
      </categories>
      <tags>
        <tag>javascript</tag>
        <tag>vue</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[æ·±å…¥ç†è§£å¼‚æ­¥ç¼–ç¨‹çš„åŽŸç†]]></title>
    <url>%2F2019%2F07%2F18%2Funderstand-async-programming%2F</url>
    <content type="text"><![CDATA[å¼‚æ­¥çš„é«˜æ€§èƒ½ä¸º Node å¸¦æ¥äº†é«˜åº¦çš„èµžèª‰ï¼Œè€Œå¼‚æ­¥ç¼–ç¨‹ä¹Ÿä¸ºå…¶å¸¦æ¥äº†éƒ¨åˆ†çš„è¯‹æ¯ã€‚ å¼‚æ­¥ç¼–ç¨‹ä»Žæ—©æœŸçš„ callbackã€äº‹ä»¶å‘å¸ƒ\è®¢é˜…æ¨¡å¼åˆ° ES6 çš„ Promiseã€Generator åœ¨åˆ° ES2017 ä¸­ asyncï¼Œçœ‹ä¼¼é£Žæ ¼è¿¥å¼‚ï¼Œä½†æ˜¯è¿˜æ˜¯æœ‰ä¸€æ¡æš—çº¿å°†å®ƒä»¬ä¸²è”åœ¨ä¸€èµ·çš„ï¼Œå°±æ˜¯å¸Œæœ›å°†å¼‚æ­¥ç¼–ç¨‹çš„ä»£ç è¡¨è¾¾å°½é‡åœ°è´´åˆè‡ªç„¶è¯­è¨€çš„çº¿æ€§æ€ç»´ã€‚ ä»¥è¿™æ¡æš—çº¿å°†ä¸Šè¿°å‡ ç§è§£å†³æ–¹æ¡ˆè¿žåœ¨ä¸€èµ·ï¼Œå°±å¯ä»¥æ›´å¥½åœ°ç†è§£å¼‚æ­¥ç¼–ç¨‹çš„åŽŸç†ã€é­…åŠ›ã€‚ â”œâ”€â”€ äº‹ä»¶å‘å¸ƒ\è®¢é˜…æ¨¡å¼ &lt;= Callback â”œâ”€â”€ Promise &lt;= äº‹ä»¶å‘å¸ƒ\è®¢é˜…æ¨¡å¼ â”œâ”€â”€ Asyncã€Await &lt;= Promiseã€Generator äº‹ä»¶å‘å¸ƒ\è®¢é˜…æ¨¡å¼ &lt;= Callbackè¿™ä¸ªæ¨¡å¼æœ¬è´¨ä¸Šå°±æ˜¯å›žè°ƒå‡½æ•°çš„äº‹ä»¶åŒ–ã€‚å®ƒæœ¬èº«å¹¶æ— åŒæ­¥ã€å¼‚æ­¥è°ƒç”¨çš„é—®é¢˜ï¼Œæˆ‘ä»¬åªæ˜¯ä½¿ç”¨å®ƒæ¥å®žçŽ°äº‹ä»¶ä¸Žå›žè°ƒå‡½æ•°ä¹‹é—´çš„å…³è”ã€‚æ¯”è¾ƒå…¸åž‹çš„æœ‰ NodeJS çš„ events æ¨¡å— 12345678const &#123; EventEmitter &#125; = require('events')const eventEmitter = new EventEmitter()// è®¢é˜…eventEmitter.on("event", function(msg) &#123; console.log("event", msg)&#125;)// å‘å¸ƒeventEmitter.emit("event", "Hello world") é‚£ä¹ˆè¿™ç§æ¨¡å¼æ˜¯å¦‚ä½•ä¸Ž Callback å…³è”çš„å‘¢ï¼Ÿæˆ‘ä»¬å¯ä»¥åˆ©ç”¨ Javascript ç®€å•å®žçŽ° EventEmitterï¼Œç­”æ¡ˆå°±æ˜¾è€Œæ˜“è§äº†ã€‚ 123456789101112131415161718192021222324252627282930class usrEventEmitter &#123; constructor () &#123; this.listeners = &#123;&#125; &#125; // è®¢é˜…ï¼Œcallback ä¸ºæ¯ä¸ª event çš„ä¾¦å¬å™¨ on(eventName, callback) &#123; if (!this.listeners[eventName]) this.listeners[eventName] = [] this.listeners[eventName].push(callback) &#125; // å‘å¸ƒ emit(eventName, params) &#123; this.listeners[eventName].forEach(callback =&gt; &#123; callback(params) &#125;) &#125; // æ³¨é”€ off(eventName, callback) &#123; const rest = this.listeners[eventName].fitler(elem =&gt; elem !== callback) this.listeners[eventName] = rest &#125; // è®¢é˜…ä¸€æ¬¡ once(eventName, callback) &#123; const handler = function() &#123; callback() this.off(eventName, handler) &#125; this.on(eventName, handler) &#125;&#125; ä¸Šè¿°å®žçŽ°å¿½ç•¥äº†å¾ˆå¤šç»†èŠ‚ï¼Œä¾‹å¦‚å¼‚å¸¸å¤„ç†ã€å¤šå‚æ•°ä¼ é€’ç­‰ã€‚åªæ˜¯ä¸ºäº†å±•ç¤ºäº‹ä»¶è®¢é˜…\å‘å¸ƒæ¨¡å¼ã€‚ å¾ˆæ˜Žæ˜¾çš„çœ‹å‡ºï¼Œæˆ‘ä»¬ä½¿ç”¨è¿™ç§è®¾è®¡æ¨¡å¼å¯¹å¼‚æ­¥ç¼–ç¨‹åšäº†é€»è¾‘ä¸Šçš„åˆ†ç¦»ï¼Œå°†å…¶è¯­ä¹‰åŒ–ä¸º 1234// ä¸€äº›äº‹ä»¶å¯èƒ½ä¼šè¢«è§¦å‘eventEmitter.on// å½“å®ƒå‘ç”Ÿçš„æ—¶å€™ï¼Œè¦è¿™æ ·å¤„ç†eventEmitter.emit ä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘ä»¬å°†æœ€åˆçš„ Callback å˜æˆäº†äº‹ä»¶ç›‘å¬å™¨ï¼Œä»Žè€Œä¼˜é›…åœ°è§£å†³å¼‚æ­¥ç¼–ç¨‹ã€‚ Promise &lt;= äº‹ä»¶å‘å¸ƒ\è®¢é˜…æ¨¡å¼ä½¿ç”¨äº‹ä»¶å‘å¸ƒ\è®¢é˜…æ¨¡å¼æ—¶ï¼Œéœ€è¦æˆ‘ä»¬äº‹å…ˆä¸¥è°¨åœ°è®¾ç½®ç›®æ ‡ï¼Œä¹Ÿå°±æ˜¯ä¸Šé¢æ‰€è¯´çš„ï¼Œå¿…é¡»è¦ç¼œå¯†åœ°è®¾å®šå¥½æœ‰å“ªäº›äº‹ä»¶ä¼šå‘ç”Ÿã€‚è¿™ä¸Žæˆ‘ä»¬è¯­è¨€çš„çº¿æ€§æ€ç»´å¾ˆè¿å’Œã€‚é‚£ä¹ˆæœ‰æ²¡æœ‰ä¸€ç§æ–¹å¼å¯ä»¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œç¤¾åŒºäº§å‡ºäº† Promiseã€‚ 1234567891011const promise = new Promise(function(resolve, reject) &#123; try &#123; setTimeout(() =&gt; &#123; resolve('hello world') &#125;, 500) &#125; catch (error) &#123; reject(error) &#125;&#125;)// è¯­ä¹‰å°±å˜ä¸ºå…ˆå‘ç”Ÿä¸€äº›å¼‚æ­¥è¡Œä¸ºï¼Œthen æˆ‘ä»¬åº”è¯¥è¿™ä¹ˆå¤„ç†promise.then(msg =&gt; console.log(msg)).catch(error =&gt; console.log('err', error)) é‚£ä¹ˆè¿™ç§ Promise ä¸Žäº‹ä»¶å‘å¸ƒ\è®¢é˜…æ¨¡å¼æœ‰ä»€ä¹ˆè”ç³»å‘¢ï¼Ÿæˆ‘ä»¬å¯ä»¥åˆ©ç”¨ EventEmitter æ¥å®žçŽ° Promiseï¼Œè¿™æ ·å¯èƒ½ä¼šå¯¹ä½ æœ‰æ‰€å¯å‘ã€‚ æˆ‘ä»¬å¯ä»¥å°† Promise è§†ä¸ºä¸€ä¸ª EventEmitterï¼Œå®ƒåŒ…å«äº† { state: &#39;pending&#39; } æ¥æè¿°å½“å‰çš„çŠ¶æ€ï¼ŒåŒæ—¶ä¾¦å¬å®ƒçš„å˜åŒ– å½“æˆåŠŸæ—¶ { state: &#39;fulfilled&#39; }ï¼Œè¦åšäº›ä»€ä¹ˆ on(&#39;resolve&#39;, callback)ï¼› å½“å¤±è´¥æ—¶ { state: &#39;rejected&#39; }ï¼Œè¦åšäº›ä»€ä¹ˆ on(&#39;reject&#39;, callback)ã€‚ å…·ä½“å®žçŽ°å¦‚ä¸‹ 1234567891011121314151617181920212223242526272829303132333435363738394041424344const &#123; EventEmitter &#125; = require('events')class usrPromise extends EventEmitter &#123; // æž„é€ æ—¶å€™æ‰§è¡Œ constructor(executor) &#123; super() // å‘å¸ƒ const resolve = (value) =&gt; this.emit('resolve', value) const reject = (reason) =&gt; this.emit('reject', reason) if (executor) &#123; // æ¨¡æ‹Ÿ event loopï¼Œæ³¨æ­¤å¤„åˆ©ç”¨ Macrotask æ¥æ¨¡æ‹Ÿ Microtask setTimeout(() =&gt; executor(resolve, reject)) &#125; &#125; then(resolveHandler, rejectHandler) &#123; const nextPromise = new usrPromise() // è®¢é˜… resolve äº‹ä»¶ if (resolveHandler) &#123; const resolve = (data) =&gt; &#123; const result = resolveHandler(data) nextPromise.emit('resolve', result) &#125; this.on('resolve', resolve) &#125; // è®¢é˜… reject äº‹ä»¶ if (rejectHandler) &#123; const reject = (data) =&gt; &#123; const result = rejectHandler(data) nextPromise.emit('reject', result) &#125; this.on('reject', reject) &#125; else &#123; this.on('reject', (data) =&gt; &#123; promise.emit('reject', data) &#125;) &#125; return nextPromise &#125; catch(handler) &#123; this.on('reject', handler) &#125;&#125; å¼•ç”¨äºŽ https://gist.github.com/dmvaldman/12a7e46be6c3097aae31ä¸ºäº†æ›´å¥½åœ°æ¨¡æ‹Ÿ Promise æœºåˆ¶ï¼Œä¿®æ”¹äº†ä¸€ç‚¹ã€‚ å¦‚æžœéœ€è¦è¿›ä¸€æ­¥äº†è§£äº‹ä»¶æœºåˆ¶ï¼Œè§https://juejin.im/post/5c4041805188252420629086ã€‚ æˆ‘ä»¬ä½¿ç”¨ then æ–¹æ³•æ¥å°†é¢„å…ˆéœ€è¦å®šä¹‰çš„äº‹ä»¶ä¾¦å¬å™¨å­˜æ”¾èµ·æ¥ï¼ŒåŒæ—¶åœ¨ executor ä¸­è®¾å®šè¿™äº›äº‹ä»¶è¯¥åœ¨ä»€ä¹ˆæ—¶å€™å®žè¡Œã€‚ å¯ä»¥çœ‹å‡ºä»Žäº‹ä»¶å‘å¸ƒ\è®¢é˜…æ¨¡å¼åˆ° Promiseï¼Œå¸¦æ¥äº†è¯­ä¹‰ä¸Šçš„å·¨å¤§å˜é©ï¼Œä½†æ˜¯è¿˜æ˜¯éœ€è¦ä½¿ç”¨ new Promise æ¥æè¿°æ•´ä¸ªçŠ¶æ€çš„è½¬æ¢ï¼Œé‚£ä¹ˆæœ‰æ²¡æœ‰æ›´å¥½åœ°å®žçŽ°æ–¹å¼å‘¢ï¼Ÿ asyncã€await &lt;= Promiseã€Generatorasyncã€await æ ‡å‡†æ˜¯ ES 2017 å¼•å…¥ï¼Œæä¾›ä¸€ç§æ›´åŠ ç®€æ´çš„å¼‚æ­¥è§£å†³æ–¹æ¡ˆã€‚ 1234567891011121314async function say(greeting) &#123; return new Promise(function(resolve, then) &#123; setTimeout(function() &#123; resolve(greeting) &#125;, 1500) &#125;)&#125;;(async function() &#123; let v1 = await say('Hello') console.log(v1) let v2 = await say('World') console.log(v2)&#125;)() await å¯ä»¥ç†è§£ä¸ºæš‚åœå½“å‰ async function çš„æ‰§è¡Œï¼Œç­‰å¾… Promise å¤„ç†å®Œæˆã€‚ã€‚è‹¥ Promise æ­£å¸¸å¤„ç†ï¼ˆfulfilledï¼‰ï¼Œå…¶å›žè°ƒçš„resolveå‡½æ•°å‚æ•°ä½œä¸º await è¡¨è¾¾å¼çš„å€¼ã€‚ asyncã€await çš„å‡ºçŽ°ï¼Œå‡å°‘äº†å¤šä¸ª then çš„é“¾å¼è°ƒç”¨å½¢å¼çš„ä»£ç ã€‚ä¸‹é¢æˆ‘ä»¬ç»“åˆ Promise ä¸Ž Generator æ¥å®žçŽ° asyncã€await 123456789101112131415161718192021222324252627282930313233function async(makeGenerator) &#123; return function() &#123; const generator = makeGenerator.apply(this, arguments) function handle(&#123; value, done &#125;) &#123; if (done === true) return Promise.resolve(value) return Promise.resolve(value).then( (res) =&gt; &#123; return handle(generator.next(res)) &#125;, function(err) &#123; return handle(generator.throw(err)) &#125; ) &#125; try &#123; return handle(generator.next()) &#125; catch (ex) &#123; return Promise.reject(ex) &#125; &#125;&#125;async(function*() &#123; var v1 = yield say('hello') console.log(1, v1) var v2 = yield say('world') console.log(2, v2)&#125;)() æœ¬è´¨ä¸Šå°±æ˜¯åˆ©ç”¨é€’å½’å®Œæˆ function* () { ... } çš„è‡ªåŠ¨æ‰§è¡Œã€‚ç›¸æ¯”ä¸Ž Generator å‡½æ•°ï¼Œè¿™ç§å½¢å¼æ— éœ€æ‰‹åŠ¨æ‰§è¡Œï¼Œå¹¶ä¸”å…·æœ‰æ›´å¥½çš„è¯­ä¹‰ã€‚ å¼•ç”¨ï¼š æ·±å…¥æµ…å‡º NodeJS ES6 å…¥é—¨ PromiseJS]]></content>
      <categories>
        <category>web</category>
      </categories>
      <tags>
        <tag>javascript</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[React & Redux in TypeScript - é™æ€ç±»åž‹æŒ‡å—]]></title>
    <url>%2F2019%2F07%2F17%2Freact-in-ts%2F</url>
    <content type="text"><![CDATA[ç¿»è¯‘è‡ª react-redux-typescript-guideï¼Œä½œè€…ï¼šPiotrek Witek ç¿»è¯‘è‡ª TypeScriptã§Redux Thunkã‚’ä½¿ã†ï¼Œä½œè´£ï¼šYusuke Mori å‚è€ƒæ–‡ç«  TypeScript 2.8ä¸‹çš„ç»ˆæžReactç»„ä»¶æ¨¡å¼ æ¦‚è¿°ï¼šæœ€è¿‘åœ¨å­¦ä¹  react&amp;TypeScriptï¼Œå‘çŽ°æœ‰è®¸å¤šçš„ç»„ä»¶æ¨¡å¼å’Œæ–¹æ³•éœ€è¦åŽ»æ¢³ç†å’Œæ€»ç»“ã€‚æ‰€ä»¥é€‰æ‹©ä¸€äº›æ–‡ç« ç”¨äºŽæ²‰æ·€å’Œæ€è€ƒï¼Œè®°å½•ä¸‹ä¸€äº›çŸ¥è¯†ç‚¹ï¼Œå’Œå¤§å®¶æŽ¢è®¨ã€‚ publishï¼š2019-03-21 ç›®å½•ï¼š ç®€ä»‹ï¼ŒçŽ¯å¢ƒé…ç½®ï¼ˆcreate-react-appï¼‰ React - å…³é”®ç±»åž‹ï¼ˆreact-redux-typescript-guide ï¼‰ React - ç»„ä»¶æ¨¡å¼ï¼ˆreact-redux-typescript-guide &amp; TypeScript 2.8ä¸‹çš„ç»ˆæžReactç»„ä»¶æ¨¡å¼ï¼‰ Redux - ä½¿ç”¨ä»¥åŠ Redux Thunk ä½¿ç”¨ï¼ˆTypeScriptã§Redux Thunkã‚’ä½¿ã†ï¼‰ æ€»ç»“ React - å…³é”®ç±»åž‹ å±•ç¤ºæ€§ç»„ä»¶ï¼ˆFunctionComponentï¼‰ React.FunctionComponent&lt;P&gt; or React.FC&lt;P&gt;ã€‚ const MyComponent: React.FC&lt;Props&gt; = ... æœ‰çŠ¶æ€ç»„ä»¶ï¼ˆClassComponentï¼‰ React.Component&lt;P, S&gt; class MyComponent extends React.Component&lt;Props, State&gt; { ... ç»„ä»¶Props React.ComponentProps&lt;typeof Component&gt; èŽ·å–ç»„ä»¶ï¼ˆé€‚ç”¨äºŽClassComponentã€FunctionComponentï¼‰çš„Propsçš„ç±»åž‹ type MyComponentProps = React.ComponentProps&lt;typeof MyComponent&gt;; React.FC | React.Componentçš„è”åˆç±»åž‹ React.ComponentType&lt;P&gt; 123const withState = &lt;P extends WrappedComponentProps&gt;( WrappedComponent: React.ComponentType&lt;P&gt;,) =&gt; &#123; ... React è¦ç´  React.ReactElement&lt;P&gt; or JSX.Element è¡¨ç¤ºReactå…ƒç´ æ¦‚å¿µçš„ç±»åž‹ - DOMç»„ä»¶ï¼ˆä¾‹å¦‚ï¼‰æˆ–ç”¨æˆ·å®šä¹‰çš„å¤åˆç»„ä»¶ï¼ˆï¼‰ const elementOnly: React.ReactElement = &lt;div /&gt; || &lt;MyComponent /&gt;; React Node React.ReactNode è¡¨ç¤ºä»»ä½•ç±»åž‹çš„ReactèŠ‚ç‚¹ï¼ˆåŸºæœ¬ä¸Šæ˜¯ReactElementï¼ˆåŒ…æ‹¬Fragmentså’ŒPortalsï¼‰+ åŽŸå§‹JSç±»åž‹ çš„åˆé›†ï¼‰ 12const elementOrPrimitive: React.ReactNode = 'string' || 0 || false || null || undefined || &lt;div /&gt; || &lt;MyComponent /&gt;;const Component = (&#123; children: React.ReactNode &#125;) =&gt; ... React CSSå±žæ€§ React.CSSProperties ä»£è¡¨ç€Style Objectåœ¨ JSX æ–‡ä»¶ä¸­ï¼ˆé€šå¸¸ç”¨äºŽ css-in-jsï¼‰ 12const styles: React.CSSProperties = &#123; flexDirection: 'row', ...const element = &lt;div style=&#123;styles&#125; ... é€šç”¨çš„ React Event Handler React.ReactEventHandler&lt;HTMLElement&gt; 123const handleChange: React.ReactEventHandler&lt;HTMLInputElement&gt; = (ev) =&gt; &#123; ... &#125; &lt;input onChange=&#123;handleChange&#125; ... /&gt; ç‰¹æ®Šçš„ React Event Handler React.MouseEvent&lt;E&gt; | React.KeyboardEvent&lt;E&gt; | React.TouchEvent&lt;E&gt; 123const handleChange = (ev: React.MouseEvent&lt;HTMLDivElement&gt;) =&gt; &#123; ... &#125;&lt;div onMouseMove=&#123;handleChange&#125; ... /&gt; React ç»„ä»¶æ¨¡å¼ Function Components - FC çº¯å‡½æ•°ç»„ä»¶ï¼ˆæ— çŠ¶æ€ï¼‰ é¡¾åæ€ä¹‰ï¼Œçº¯å‡½æ•°ç»„ä»¶æœ¬èº«ä¸å…·å¤‡ Stateï¼Œæ‰€ä»¥æ²¡æœ‰çŠ¶æ€ï¼Œä¸€åˆ‡é€šè¿‡ Props 12345678910111213141516171819202122import React, &#123; FC, ReactElement, MouseEvent &#125; from 'react'type Props = &#123; label: string, children: ReactElement, onClick?: (e: MouseEvent&lt;HTMLButtonElement&gt;) =&gt; void&#125;const FunctionComponent: FC&lt;Props&gt; = (&#123; label, children, onClick &#125;: Props) =&gt; &#123; return ( &lt;div&gt; &lt;span&gt; &#123;label&#125;ï¼š &lt;/span&gt; &lt;button type="button" onClick=&#123;onClick&#125;&gt; &#123;children&#125; &lt;/button&gt; &lt;/div&gt; )&#125;export default FunctionComponent æ‰©å±•å±žæ€§ï¼ˆspread attributesï¼‰ åˆ©ç”¨ ... å¯¹å‰©ä½™å±žæ€§è¿›è¡Œå¤„ç† 12345678910111213141516171819202122import React, &#123; FC, ReactElement, MouseEvent, CSSProperties &#125; from 'react'type Props = &#123; label: string, children: ReactElement, className?: string, style?: CSSProperties, onClick?: (e: MouseEvent&lt;HTMLButtonElement&gt;) =&gt; void,&#125;const FunctionComponent: FC&lt;Props&gt; = (&#123; label, children, onClick, ...resetProps &#125;: Props) =&gt; &#123; return ( &lt;div &#123;...resetProps&#125;&gt; &lt;span&gt;&#123;label&#125;ï¼š&lt;/span&gt; &lt;button type="button" onClick=&#123;onClick&#125;&gt; &#123;children&#125; &lt;/button&gt; &lt;/div&gt; )&#125;export default FunctionComponent é»˜è®¤å±žæ€§ å¦‚æžœï¼Œéœ€è¦é»˜è®¤å±žæ€§ï¼Œå¯ä»¥é€šè¿‡é»˜è®¤å‚æ•°å€¼æ¥å¤„ç† 123456789101112131415161718192021import React, &#123; FC, ReactElement, MouseEvent &#125; from 'react'type Props = &#123; label?: string, children: ReactElement,&#125;const FunctionComponent: FC&lt;Props&gt; = (&#123; label = 'Hello', children &#125;: Props) =&gt; &#123; return ( &lt;div&gt; &lt;span&gt; &#123;label&#125;ï¼š &lt;/span&gt; &lt;button type="button"&gt; &#123;children&#125; &lt;/button&gt; &lt;/div&gt; )&#125;export default FunctionComponent Class Components ç›¸å¯¹äºŽFCï¼Œå¤šäº† stateï¼Œé‡‡ç”¨å¦‚ä¸‹å½¢å¼æ¥å®šä¹‰Class Component è¿™ä¸€éƒ¨åˆ†çš„å†™æ³•ï¼Œä¸ŽTypeScript 2.8ä¸‹çš„ç»ˆæžReactç»„ä»¶æ¨¡å¼ç›¸åŒï¼Œè§‰å¾—ç»“æž„å¾ˆæ¸…æ™°ï¼Œå¤ç”¨ã€‚ 1234567891011121314151617181920212223242526272829303132333435363738import React, &#123; Component &#125; from 'react';type Props = &#123; label: string&#125;const initialState = &#123; count: 0&#125;type State = Readonly&lt;typeof initialState&gt;class ClassCounter extends Component&lt;Props, State&gt; &#123; readonly state: State = initialState private handleIncrement = () =&gt; this.setState(Increment) render() &#123; const &#123; handleIncrement &#125; = this; const &#123; label &#125; = this.props; const &#123; count &#125; = this.state; return ( &lt;div&gt; &lt;span&gt; &#123;label&#125;: &#123;count&#125; &lt;/span&gt; &lt;button type="button" onClick=&#123;handleIncrement&#125;&gt; &#123;`Increment`&#125; &lt;/button&gt; &lt;/div&gt; ) &#125;&#125;export const Increment = (preState: State) =&gt; (&#123; count: preState.count + 1 &#125;)export default ClassCounter é»˜è®¤å±žæ€§ å¤„ç† Class Component çš„é»˜è®¤å±žæ€§ï¼Œä¸»è¦æœ‰ä¸¤ç§æ–¹æ³•ï¼š ä¸€æ˜¯å®šä¹‰é«˜é˜¶ç»„ä»¶ï¼Œä¾‹å¦‚TypeScript 2.8ä¸‹çš„ç»ˆæžReactç»„ä»¶æ¨¡å¼ä¸­ï¼Œåˆ©ç”¨ withDefaultProps æ¥å®šä¹‰é»˜è®¤å±žæ€§ï¼Œæ¶‰åŠç»„ä»¶çš„å±žæ€§çš„ç±»åž‹è½¬æ¢ï¼› äºŒæ˜¯åˆ©ç”¨ static props ä»¥åŠ componentWillReceivePropsï¼Œå¤„ç†é»˜è®¤å±žæ€§ã€‚ å…·ä½“ä¸šåŠ¡ä¸­ï¼Œè§†æƒ…å†µè€Œå®šï¼Œç¬¬ä¸€ä¸­å¯ä»¥æŸ¥çœ‹ç›¸å…³æ–‡ç« ï¼Œè¿™é‡Œä»‹ç»ç¬¬äºŒç§ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748import React, &#123; Component &#125; from 'react';type Props = &#123; label: string, initialCount: number&#125;type State = &#123; count: number;&#125;class ClassCounter extends Component&lt;Props, State&gt; &#123; static defaultProps = &#123; initialCount: 1, &#125; // ä¾æ® defaultProps å¯¹ state è¿›è¡Œå¤„ç† readonly state: State = &#123; count: this.props.initialCount, &#125; private handleIncrement = () =&gt; this.setState(Increment) // å“åº” defaultProps çš„å˜åŒ– componentWillReceiveProps(&#123; initialCount &#125;: Props) &#123; if (initialCount != null &amp;&amp; initialCount !== this.props.initialCount) &#123; this.setState(&#123; count: initialCount &#125;) &#125; &#125; render() &#123; const &#123; handleIncrement &#125; = this; const &#123; label &#125; = this.props; const &#123; count &#125; = this.state; return ( &lt;div&gt; &lt;span&gt; &#123;label&#125;: &#123;count&#125; &lt;/span&gt; &lt;button type="button" onClick=&#123;handleIncrement&#125;&gt; &#123;`Increment`&#125; &lt;/button&gt; &lt;/div&gt; ) &#125;&#125;export const Increment = (preState: State) =&gt; (&#123; count: preState.count + 1 &#125;)export default ClassCounter é€šç”¨ç»„ä»¶ Generic Components å¤ç”¨å…±æœ‰çš„é€»è¾‘åˆ›å»ºç»„ä»¶ å¸¸ç”¨äºŽé€šç”¨åˆ—è¡¨ 12345678910111213141516import React, &#123; Component, ReactElement &#125; from 'react'interface GenericListProps&lt;T&gt; &#123; items: T[], itemRenderer: (item: T, i: number) =&gt; ReactElement,&#125;class GenericList&lt;T&gt; extends Component&lt;GenericListProps&lt;T&gt;, &#123;&#125;&gt; &#123; render() &#123; const &#123; items, itemRenderer &#125; = this.props return &lt;div&gt;&#123;items.map(itemRenderer)&#125;&lt;/div&gt; &#125;&#125;export default GenericList Render Callback &amp; Render Props Render Callbackï¼Œä¹Ÿè¢«ç§°ä¸ºå‡½æ•°å­ç»„ä»¶ï¼Œå°±æ˜¯å°† children æ›¿æ¢ä¸º () =&gt; childrenï¼› Render Propsï¼Œå°±æ˜¯å°† () =&gt; component ä½œä¸º Props ä¼ é€’ä¸‹åŽ»ã€‚ 1234567891011121314151617181920212223242526272829import React, &#123; Component, ReactElement &#125; from 'react';type Props = &#123; PropRender?: () =&gt; ReactElement, children?: () =&gt; ReactElement&#125;class PropRender extends Component&lt;Props, &#123;&#125;&gt; &#123; render() &#123; const &#123; props: &#123; children, PropRender &#125; &#125;: &#123; props: Props &#125; = this; return ( &lt;div&gt; &#123; PropRender &amp;&amp; PropRender() &#125; &#123; children &amp;&amp; children() &#125; &lt;/div&gt; ) &#125;&#125;export default PropRender// åº”ç”¨&lt;PropsRender PropRender=&#123;() =&gt; (&lt;p&gt;Prop Render&lt;/p&gt;)&#125; &gt; &#123; () =&gt; (&lt;p&gt;Child Render&lt;/p&gt;) &#125; &lt;/PropsRender&gt; HOCï¼ˆHigher-Order Componentsï¼‰ ç®€å•ç†è§£ä¸ºï¼ŒæŽ¥å—Reactç»„ä»¶ä½œä¸ºè¾“å…¥ï¼Œè¾“å‡ºä¸€ä¸ªæ–°çš„Reactç»„ä»¶çš„ç»„ä»¶çš„å·¥åŽ‚å‡½æ•°ã€‚ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546import * as React from 'react'interface InjectedProps &#123; label: string&#125;export const withState = &lt;BaseProps extends InjectedProps&gt;( BaseComponent: React.ComponentType&lt;BaseProps&gt;) =&gt; &#123; type HocProps = BaseProps &amp; InjectedProps &amp; &#123; initialCount?: number &#125; type HocState = &#123; readonly count: number &#125; return class Hoc extends React.Component&lt;HocProps, HocState&gt; &#123; // æ–¹ä¾¿ debugging in React-Dev-Tools static displayName = `withState($&#123;BaseComponent.name&#125;)`; // å…³è”åŽŸå§‹çš„ wrapped component static readonly WrappedComponent = BaseComponent; readonly state: HocState = &#123; count: Number(this.props.initialCount) || 0, &#125; handleIncrement = () =&gt; &#123; this.setState(&#123; count: this.state.count + 1 &#125;) &#125; render() &#123; const &#123; ...restProps &#125; = this.props as any const &#123; count &#125; = this.state return ( &lt;&gt; &#123;count&#125; &lt;BaseComponent onClick=&#123;this.handleIncrement&#125; &#123;...restProps&#125; /&gt; &lt;/&gt; ) &#125; &#125;&#125; Redux - ä½¿ç”¨ä»¥åŠ Redux Thunk ä½¿ç”¨ä»¥å¦‚ä¸‹å½¢å¼æ¥ä»‹ç»Reduxï¼Œä¸»è¦æ˜¯in-tsçš„ä½¿ç”¨ï¼š (prestate, action) =&gt; stateï¼› ä½¿ç”¨Redux Thunk æ¥å‡ºæ¥å¼‚æ­¥æ“ä½œã€‚ 123456789101112131415// store.jstype DataType = &#123; counter: number&#125;const DataState: DataType = &#123; counter: 0&#125;type RootState = &#123; Data: DataType&#125;export default RootState 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849// action.jsimport &#123; Action, AnyAction &#125; from 'redux'import &#123; ThunkAction, ThunkDispatch &#125; from 'redux-thunk'import RootState from '../store/index'type IncrementPayload = &#123; value: number&#125;interface IncrementAction extends Action &#123; type: 'INCREMENT', payload: IncrementPayload&#125;export const Increment = (&#123; value &#125;: IncrementPayload): IncrementAction =&gt; &#123; const payload = &#123; value &#125; return &#123; type: 'INCREMENT', payload &#125;&#125;export type DecrementPayload = &#123; value: number;&#125;;export interface DecrementAction extends Action &#123; type: 'DECREMENT'; payload: DecrementPayload;&#125;export type RootAction = IncrementAction &amp; DecrementAction;export const asyncIncrement = ( payload: IncrementPayload): ThunkAction&lt;Promise&lt;void&gt;, RootState, void, AnyAction&gt; =&gt; &#123; return async (dispatch: ThunkDispatch&lt;RootState, void, AnyAction&gt;): Promise&lt;void&gt; =&gt; &#123; return new Promise&lt;void&gt;((resolve) =&gt; &#123; console.log('Login in progress') setTimeout(() =&gt; &#123; dispatch(Increment(payload)) setTimeout(() =&gt; &#123; resolve() &#125;, 1000) &#125;, 3000) &#125;) &#125;&#125; 123456789101112131415// reducer.jsimport &#123; DataState, DataType &#125; from '../store/Data'import &#123; RootAction &#125; from '../actions/'export default function (state: DataType = DataState, &#123; type, payload &#125;: RootAction): DataType &#123; switch(type) &#123; case 'INCREMENT': return &#123; ...state, counter: state.counter + payload.value, &#125;; default: return state; &#125;&#125; 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566// Hearder.jsimport React, &#123; Component, ReactNode &#125; from 'react'import RootState from '../store/index'import &#123; Dispatch, AnyAction &#125; from 'redux'import &#123; ThunkDispatch &#125; from 'redux-thunk'import &#123; connect &#125; from 'react-redux'import &#123; Increment, asyncIncrement &#125; from '../actions/'const initialState = &#123; name: 'string'&#125;type StateToPropsType = Readonly&lt;&#123; counter: number&#125;&gt;type DispatchToPropsType = Readonly&lt;&#123; handleAdd: () =&gt; void, handleDec: () =&gt; void&#125;&gt;type StateType = Readonly&lt;typeof initialState&gt;type PropsType = &#123; children?: ReactNode&#125;type ComponentProps = StateToPropsType &amp; DispatchToPropsType &amp; PropsTypeclass Header extends Component&lt;ComponentProps, StateType&gt; &#123; readonly state: StateType = initialState; render() &#123; const &#123; props: &#123; handleAdd, handleDec, counter &#125;, state: &#123; name &#125; &#125; = this return ( &lt;div&gt; è®¡æ•°ï¼š&#123;counter&#125; &lt;button onClick=&#123;handleAdd&#125;&gt;+&lt;/button&gt; &lt;button onClick=&#123;handleDec&#125;&gt;-&lt;/button&gt; &lt;/div&gt; ) &#125; private handleClick = () =&gt; this.setState(sayHello);&#125;const sayHello = (prevState: StateType) =&gt; (&#123; name: prevState.name + 'Hello world',&#125;)const mapStateToProps = (state: RootState, props: PropsType): StateToPropsType =&gt; &#123; return &#123; counter: state.Data.counter &#125;&#125;const mapDispatchToProps = (dispatch: ThunkDispatch&lt;RootState, void, AnyAction&gt;): DispatchToPropsType =&gt; &#123; return &#123; handleAdd: () =&gt; &#123; dispatch(Increment(&#123; value: 2 &#125;)) &#125;, handleDec: async () =&gt; &#123; dispatch(asyncIncrement(&#123; value: 10 &#125;)) &#125; &#125;&#125;export default connect&lt;StateToPropsType, DispatchToPropsType, PropsType, RootState&gt;(mapStateToProps, mapDispatchToProps)(Header)]]></content>
      <categories>
        <category>web</category>
      </categories>
      <tags>
        <tag>react</tag>
        <tag>typescript</tag>
      </tags>
  </entry>
</search>
